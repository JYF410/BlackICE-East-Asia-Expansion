

scripted_gui = {
	BI_research_slot_tab = {
		context_type = player_context
		
		window_name = "research_tab_container"
		parent_window_token = technology_tab
	}
	BI_research_slot_view = {
		context_type = player_context
		
		window_name = "research_slot_info_container"
		parent_window_name = "research_slots_hook"
		#parent_window_token = technology_tab
        
		visible = {
		}
		
		#dirty = ui_research
		
		effects = {
			research_slot_overlay_1_click = {
				ROOT = {
					set_variable = { selected_research_slot = 1 }
					
					set_country_flag = UNLOCK:infantry_folder
					set_country_flag = UNLOCK:special_forces
					set_country_flag = UNLOCK:support_folder
					set_country_flag = UNLOCK:artillery_folder
					set_country_flag = UNLOCK:tank_techs_folder
					set_country_flag = UNLOCK:armor_folder
					set_country_flag = UNLOCK:air_techs_folder
					set_country_flag = UNLOCK:air_techs_folder_army
					set_country_flag = UNLOCK:air_techs_folder_navy
					set_country_flag = UNLOCK:naval_folder
					set_country_flag = UNLOCK:naval_techs_folder
					set_country_flag = UNLOCK:industry_folder
					set_country_flag = UNLOCK:raw_materials_folder
					set_country_flag = UNLOCK:ww1_land_doctrine_folder
					set_country_flag = UNLOCK:land_doctrine_folder
					set_country_flag = UNLOCK:naval_doctrine_folder
					set_country_flag = UNLOCK:air_doctrine_folder
					set_country_flag = UNLOCK:electronics_folder
					set_country_flag = UNLOCK:nuclear_folder
					
					add_to_variable = { ui_research = 1 }
				}
			}
			research_slot_overlay_2_click = {
				ROOT = {
					set_variable = { selected_research_slot = 2 }
					
					set_country_flag = UNLOCK:infantry_folder
					set_country_flag = UNLOCK:special_forces
					set_country_flag = UNLOCK:support_folder
					set_country_flag = UNLOCK:artillery_folder
					set_country_flag = UNLOCK:tank_techs_folder
					set_country_flag = UNLOCK:armor_folder
					set_country_flag = UNLOCK:air_techs_folder
					set_country_flag = UNLOCK:air_techs_folder_army
					set_country_flag = UNLOCK:air_techs_folder_navy
					set_country_flag = UNLOCK:naval_folder
					set_country_flag = UNLOCK:naval_techs_folder
					set_country_flag = UNLOCK:industry_folder
					set_country_flag = UNLOCK:raw_materials_folder
					set_country_flag = UNLOCK:ww1_land_doctrine_folder
					set_country_flag = UNLOCK:land_doctrine_folder
					set_country_flag = UNLOCK:naval_doctrine_folder
					set_country_flag = UNLOCK:air_doctrine_folder
					set_country_flag = UNLOCK:electronics_folder
					set_country_flag = UNLOCK:nuclear_folder
					
					add_to_variable = { ui_research = 1 }
				}
			}
			research_slot_overlay_click = {
				set_variable = { Root.selected_research_slot = i }
				add_to_variable = { Root.selected_research_slot = 3 }
				set_research_rights = yes
					
				add_to_variable = { ROOT.ui_research = 1 }
			} 
			research_slot_overlay_right_click = {
				if = {
					limit = {
						ROOT = { has_variable = selected_research_slot }
					}
				 	ROOT = {
						clear_variable = selected_research_slot
					}
				}
				else = {
					ROOT = {
						meta_effect = {
							text = {
								goto_state = [ID]
							}
							ID = "[Prev.GetID]"
						}
					}
				}
			}
			research_slot_lost_overlay_right_click = {
				if = {
					limit = {
						ROOT = { has_variable = selected_research_slot }
					}
				 	ROOT = {
						clear_variable = selected_research_slot
						add_to_variable = { ui_research = 1 }
					}
				}
				else = {
					ROOT = {
						meta_effect = {
							text = {
								goto_state = [ID]
							}
							ID = "[Prev.GetID]"
						}
					}
				}
			}
		}
		
		dynamic_lists = {
			research_slot_list = {
				array = Root.research_slots
				change_scope = yes
				entry_container = "research_slot_container"
			}
		}
        
		triggers = {  
			research_rights_icon_list_visible = {
				set_temp_variable = { num_research_rights = 0 }
				if = { limit = { has_state_flag = SLOT:infantry_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:support_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:artillery_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:tank_techs_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:armor_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:air_techs_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:air_techs_folder_army@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:air_techs_folder_navy@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:naval_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:naval_techs_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:industry_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:raw_materials_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:ww1_land_doctrine_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:land_doctrine_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:naval_doctrine_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:air_doctrine_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:electronics_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				if = { limit = { has_state_flag = SLOT:nuclear_folder@ROOT } add_to_temp_variable = { num_research_rights = 1 } }
				
				check_variable = { num_research_rights < 10 }
			}
			research_rights_icon_list_small_visible = {
				
				check_variable = { num_research_rights > 9 }
			}
			
			marker_visible = {
				set_temp_variable = { selected = i }
				add_to_temp_variable = { selected = 3 }
				check_variable = { selected = Root.selected_research_slot }
			}
			marker_1_visible = {
				check_variable = { Root.selected_research_slot = 1 }
			}
			marker_2_visible = {
				check_variable = { Root.selected_research_slot = 2 }
			}
			research_slot_overlay_visible = {
				set_temp_variable = { selected = i }
				add_to_temp_variable = { selected = 3 }
				NOT = {
					check_variable = { Root.selected_research_slot = selected }
				}
			}
			research_slot_overlay_1_visible = {
				NOT = {
					check_variable = { Root.selected_research_slot = 1 }
				}
			} 
			research_slot_overlay_2_visible = {
				NOT = {
					check_variable = { Root.selected_research_slot = 2 }
				}
			} 
			research_slot_lost_overlay_visible = {
				NOT = {
					CONTROLLER = {
						OR = {
							tag = ROOT 
							is_ally_with = ROOT 
						}
					}
				}
			}
		}
		
	}
	BI_decision_view = {
		context_type = player_context
		
		window_name = "BI_decision_view_container"
		parent_window_token = decision_tab 
		
		dynamic_lists = {
			notification_setting = {
				array = notification_setting
				change_scope = no
				entry_container = "BI_event_settings_container"
			}
		}
          
		properties = {
			ace_checkbox = {
				frame = ace_frame?2
			}
			ace_created_checkbox = {
				frame = ace_created_frame?2
			}
			ace_died_checkbox = {
				frame = ace_died_frame?2
			}
			enemy_ace_died_checkbox = {
				frame = enemy_ace_died_frame?2
			}
			
			unit_leader_checkbox = {
				frame = unit_leader_frame?2
			}
			leader_sick_checkbox = {
				frame = unit_leader_sick_frame?2
			}
			leader_wounded_checkbox = {
				frame = unit_leader_wounded_frame?2
			}
			leader_upgrade_checkbox = {
				frame = unit_leader_upgrade_frame?2
			}
			exile_leader_checkbox = {
				frame = unit_leader_exile_frame?2
			}
			
			mob_warning_checkbox = {
				frame = mob_warning_frame?2
			}
			inv_warning_checkbox = {
				frame = inv_warning_frame?2
			}
		}
		 
		effects = {
			show_event_settings_click = {
				if = {
					limit = {
						is_in_array = { notification_setting = ROOT }
					}
					clear_array = notification_setting
				}
				else = {
					add_to_array = { notification_setting = ROOT }
				}
			}
			close_button_click = {
				clear_array = notification_setting
			}
			
			ace_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace
					}
					clr_country_flag = notif_disable_ace
				}
				else = {
					set_country_flag = notif_disable_ace
				}
			} 
			ace_created_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace_created
					}
					clr_country_flag = notif_disable_ace_created
				}
				else = {
					set_country_flag = notif_disable_ace_created
				}
			}
			ace_died_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace_died
					}
					clr_country_flag = notif_disable_ace_died
				}
				else = {
					set_country_flag = notif_disable_ace_died
				}
			}
			enemy_ace_died_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace_enemy_died
					}
					clr_country_flag = notif_disable_ace_enemy_died
				}
				else = {
					set_country_flag = notif_disable_ace_enemy_died
				}
			}
			
			unit_leader_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader
					}
					clr_country_flag = notif_disable_unit_leader
				}
				else = {
					set_country_flag = notif_disable_unit_leader
				}
			}
			leader_sick_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_sick
					}
					clr_country_flag = notif_disable_unit_leader_sick
				}
				else = {
					set_country_flag = notif_disable_unit_leader_sick
				}
			}
			leader_wounded_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_wounded
					}
					clr_country_flag = notif_disable_unit_leader_wounded
				}
				else = {
					set_country_flag = notif_disable_unit_leader_wounded
				}
			}
			leader_upgrade_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_upgrade
					}
					clr_country_flag = notif_disable_unit_leader_upgrade
				}
				else = {
					set_country_flag = notif_disable_unit_leader_upgrade
				}
			}
			exile_leader_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_exile
					}
					clr_country_flag = notif_disable_unit_leader_exile
				}
				else = {
					set_country_flag = notif_disable_unit_leader_exile
				}
			}
			mob_warning_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_mob_warning
					}
					clr_country_flag = notif_disable_mob_warning
				}
				else = {
					set_country_flag = notif_disable_mob_warning
				}
			}
			inv_warning_checkbox_click = {
				if = {
					limit = {
						has_country_flag = notif_disable_inv_warning
					}
					clr_country_flag = notif_disable_inv_warning
				}
				else = {
					set_country_flag = notif_disable_inv_warning
				}
			}
		}
		
		triggers = {
			ace_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace
					}
					set_temp_variable = { ace_frame = 1 }
				}
			}
			ace_created_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace_created
					}
					set_temp_variable = { ace_created_frame = 1 }
				}
			}
			ace_died_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace_died
					}
					set_temp_variable = { ace_died_frame = 1 }
				}
			}
			enemy_ace_died_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_ace_enemy_died
					}
					set_temp_variable = { enemy_ace_died_frame = 1 }
				}
			}
			unit_leader_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader
					}
					set_temp_variable = { unit_leader_frame = 1 }
				}
			}
			leader_sick_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_sick
					}
					set_temp_variable = { unit_leader_sick_frame = 1 }
				}
			}
			leader_wounded_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_wounded
					}
					set_temp_variable = { unit_leader_wounded_frame = 1 }
				}
			}
			leader_upgrade_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_upgrade
					}
					set_temp_variable = { unit_leader_upgrade_frame = 1 }
				}
			}
			exile_leader_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_unit_leader_exile
					}
					set_temp_variable = { unit_leader_exile_frame = 1 }
				}
			}
			mob_warning_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_mob_warning
					}
					set_temp_variable = { mob_warning_frame = 1 }
				}
			}
			inv_warning_checkbox_click_enabled = {
				if = {
					limit = {
						has_country_flag = notif_disable_inv_warning
					}
					set_temp_variable = { inv_warning_frame = 1 }
				}
			}
		}
	}
        
	#Recuitment_deployment-tab
	BI_deployment_view_menu = {
		context_type = player_context
		
		window_name = "deployment_view_menu_container"
		parent_window_token = deployment_tab
		
		effects = {
			SS_open_container_click = {
				if = {
					limit = {
						has_country_flag = show_SS_container
					}
					clr_country_flag = show_SS_container
				}
				else = {
					set_SS_division_bg_frames = yes
					set_country_flag = show_SS_container
				}
			}
			open_fake_unit_click = {
						
				set_temp_variable = { num_to_create = 24 }
				
				set_temp_variable = { max = num_armies }
				subtract_from_temp_variable = { max = num_fake_intel_divisions }
				multiply_temp_variable = { max = 0.25 } 
				clamp_temp_variable = {
					var = num_to_create
					max = max
				}
				custom_effect_tooltip = FAKE_INTEL_UNIT_AMOUNT
				create_fake_intel_units = yes
				
				set_temp_variable = { support_cost = num_to_create }
				multiply_temp_variable = { support_cost = -15 }
				add_equipment_to_stockpile = {
					type = support_equipment
					amount = var:support_cost
				}
			}	
		}
		
		triggers = {
			SS_open_container_visible = {
				has_completed_focus = GER_algemeine_ss
			}
			open_fake_unit_click_enabled = {
				
				set_temp_variable = { num_to_create = num_armies }
				subtract_from_temp_variable = { num_to_create = num_fake_intel_divisions }
				multiply_temp_variable = { num_to_create = 0.25 }
				round_temp_variable = num_to_create
				clamp_temp_variable = {
					var = num_to_create
					min = 24
				}
				
				custom_trigger_tooltip = {
					tooltip = FAKE_INTEL_UNIT_MAX
					check_variable = { num_to_create > num_fake_intel_divisions }
				}
				
				set_temp_variable = { support_cost = num_to_create }
				multiply_temp_variable = { support_cost = 15 }
				subtract_from_temp_variable = { support_cost = 1 }
				has_equipment = {
					support_equipment > support_cost
				}
			}
		}
	}
	#Trade-tab
	BI_trade_view_menu = {
		context_type = player_context
		
		window_name = "trade_view_menu_container"
		parent_window_token = trade_tab
		
		visible = {
			
		}
		
		dynamic_lists = {
			resource_list = {   
				array = global.resources
		  		change_scope = yes
				entry_container = "global_resource_entry"
			}
			trade_bonus_list = {   
				array = trade_bonus
		  		change_scope = yes
				entry_container = "trade_bonus_entry"
			}
		}   
		
		properties = {
			open_overview = { frame = open_overview }
			open_energy = { frame = open_energy }
			flag = { image = [This.GetFlag] }
			trade_bonus_toggle_subject = { frame = subject_frame }
		}

		effects = {
			open_overview_click = {
				clr_country_flag = ui_show_energy
				
				set_variable = { ui_refinery_overlay = global.date }
			}
			open_energy_click = {
				set_country_flag = ui_show_energy
			}
			
			law_click = {
				meta_effect = {
					text = {
						show_ideas_tooltip = [X]
					}
					X = "[?sublaw@token:trade_laws.GetTokenKey]"
				}
			}
			
			local_resources_icon_click = {
				MTT_get_resource_efficiency_modifiers = yes
			}
			trade_bonus_toggle_subject_click = {
				
				if = {
					limit = {
						has_country_flag = ui_hide_subject_trade
					}
					clr_country_flag = ui_hide_subject_trade
				}
				else = {
					set_country_flag = ui_hide_subject_trade
				}
			}
			target_flag_frame_click = {
				ROOT = {
					meta_effect = {
						text = {
							goto_state = [X]
						}
						X = "[?Prev.capital.GetID]"
					}
				}
			}
		}
		
		triggers = {
			trade_bonus_toggle_subject_click_enabled = {
				
				if = {
					limit = {
						has_country_flag = ui_hide_subject_trade
					}
					set_temp_variable = { subject_frame = 2 }
				}
				else = { set_temp_variable = { subject_frame = 1 } }
			}
			
			trade_bonus_subject_icon_visible = {
				num_subjects > 0
			}
			trade_bonus_toggle_subject_visible = {
				display_targeted_trade_cost = yes
				num_subjects > 0
			}
			autonomy_icon_visible = {
				is_subject_of = ROOT
				NOT = { check_variable = { trade_bonus_token^i = token:diplo_trade_bonus } }
			}
			idea_icon_visible = {
				NOT = { is_subject_of = ROOT }
				NOT = { check_variable = { trade_bonus_token^i = token:diplo_trade_bonus } }
			}
			favour_icon_visible = {
				check_variable = { trade_bonus_token^i = token:diplo_trade_bonus }
			}
			open_overview_click_enabled = {
				if = {
					limit = {
						has_country_flag = ui_show_energy
					}
					set_temp_variable = { open_overview = 2 }
				}
			}
			open_energy_click_enabled = {
				if = {
					limit = {
						NOT = { has_country_flag = ui_show_energy }
					}
					set_temp_variable = { open_energy = 2 }
				}
			}
			
			glow_visible = {
				has_country_flag = ui_show_energy
				check_variable = { ui_refinery_alert > 0 }
			}
			glowidea_visible = {
				has_country_flag = ui_show_energy
				check_variable = { ui_refinery_alert > 0 }
			}
		}
	}
	#Army-view
	BI_army_view_menu = {
		context_type = player_context
		
		window_name = "army_view_menu_container"
		parent_window_name = army_tab_hook
		
		properties = {
			army_strength = { 
				image = "[GetArmyStrengthGFX]"
			}
			field_strength = { 
				image = "[GetFieldStrengthGFX]"
			}
		}
		
		effects = {
			army_strength_click = { 
				army_strength_tooltip = yes
			}  
		}
		
		triggers = {
		}
	}
	BI_navy_view_menu = {
		context_type = player_context
		
		window_name = "navy_view_menu_container"
		parent_window_name = navy_tab_hook
		
		properties = {
			navy_strength = { 
				image = "[GetNavyStrengthGFX]"
			} 
		}
		
		effects = {
			navy_strength_click = { 
				navy_strength_tooltip = yes
			}
		}
		
		triggers = {
		}
	}
	BI_air_view_menu = {
		context_type = player_context
		
		window_name = "air_view_menu_container"
		parent_window_name = air_tab_hook
		
		properties = {
			air_strength = { 
				image = "[GetAirStrengthGFX]"
			}
		}
		
		effects = { 
			air_strength_click = {
				air_strength_tooltip = yes
			} 
			
		}
		
		triggers = {
		}  
	}
	BI_officer_window_land = {
		context_type = player_context
		
		window_name = "BI_officer_tab_container"
		parent_window_name = officer_core_view
		
		properties = {
			academy_spirit_icon = {
				image = GFX_idea_[?academy_spirit_icon.GetTokenKey]
			}
			army_spirit_icon = {
				image = GFX_idea_[?army_spirit_icon.GetTokenKey]
			}
			division_command_spirit_icon = {
				image = GFX_idea_[?division_command_spirit_icon.GetTokenKey]
			}
			air_force_spirit_icon = {
				image = GFX_idea_[?air_force_spirit_icon.GetTokenKey]
			}
			air_force_command_spirit_icon = {
				image = GFX_idea_[?air_force_command_spirit_icon.GetTokenKey]
			}
			naval_academy_spirit_icon = {
				image = GFX_idea_[?naval_academy_spirit_icon.GetTokenKey]
			}
			navy_spirit_icon = {
				image = GFX_idea_[?navy_spirit_icon.GetTokenKey]
			}
			naval_command_spirit_icon = {
				image = GFX_idea_[?naval_command_spirit_icon.GetTokenKey]
			}
			 
		} 
		
		triggers = {
			academy_spirit_icon_visible = {
				has_variable = spirit@token:academy_spirit
			}
			army_spirit_icon_visible = {
				has_variable = spirit@token:army_spirit
			}
			division_command_spirit_icon_visible = {
				has_variable = spirit@token:division_command_spirit
			}
			 
			air_force_spirit_icon_visible = {
				has_variable = spirit@token:air_force_spirit
			}
			air_force_command_spirit_icon_visible = {
				has_variable = spirit@token:air_force_command_spirit
			}
			 
			naval_academy_spirit_icon_visible = {
				has_variable = spirit@token:naval_academy_spirit
			}
			navy_spirit_icon_visible = {
				has_variable = spirit@token:navy_spirit
			}
			naval_command_spirit_icon_visible = {
				has_variable = spirit@token:naval_command_spirit
			}
			
			academy_spirit_click_enabled = {
				set_temp_variable = { academy_spirit_icon = spirit@token:academy_spirit }
			}
			army_spirit_click_enabled = {
				set_temp_variable = { army_spirit_icon = spirit@token:army_spirit }
			}
			division_command_spirit_click_enabled = {
				set_temp_variable = { division_command_spirit_icon = spirit@token:division_command_spirit }
			}
			
			naval_academy_spirit_click_enabled = {
				set_temp_variable = { naval_academy_spirit_icon = spirit@token:naval_academy_spirit }
			}
			navy_spirit_click_enabled = {
				set_temp_variable = { navy_spirit_icon = spirit@token:navy_spirit }
			}
			naval_command_spirit_click_enabled = {
				set_temp_variable = { naval_command_spirit_icon = spirit@token:naval_command_spirit }
			}
			
			air_force_spirit_click_enabled = {
				set_temp_variable = { air_force_spirit_icon = spirit@token:air_force_spirit }
			}
			air_force_command_spirit_click_enabled = {
				set_temp_variable = { air_force_command_spirit_icon = spirit@token:air_force_command_spirit }
			}
		}
		effects = {
			academy_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.academy_spirit
					
					set_temp_variable = { allowed = 1 }
					if = {
						limit = {
							meta_trigger = {
								text = {
									can_[X] = yes
								}
								X = "[?v.GetTokenKey]"
							}
						}
					}
					 
					if = {
						limit = {
							check_variable = { allowed = 1 } 
						} 
								 
						add_to_array = { selected_spirits = v }
					}
				}
				  
				set_variable = { selected_spirit_type = token:academy_spirit }
				set_variable = { selected_spirit_type_frame = 1 }
				
				set_temp_variable = { tt = token:academy_spirit } 
				if = {
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			}
			army_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.army_spirit
					
					add_to_array = { selected_spirits = v }
				} 
				
				set_variable = { selected_spirit_type = token:army_spirit }
				set_variable = { selected_spirit_type_frame = 10 }
				
				set_temp_variable = { tt = token:army_spirit } 
				if = {
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			}
			division_command_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.division_command_spirit
					
					add_to_array = { selected_spirits = v }
				}
				
				set_variable = { selected_spirit_type = token:division_command_spirit }
				set_variable = { selected_spirit_type_frame = 4 }
				
				set_temp_variable = { tt = token:division_command_spirit } 
				if = {
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = { 
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			}
			
			naval_academy_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.naval_academy_spirit
					
					add_to_array = { selected_spirits = v }
				}
				
				set_variable = { selected_spirit_type = token:naval_academy_spirit }
				set_variable = { selected_spirit_type_frame = 1 }
				
				set_temp_variable = { tt = token:naval_academy_spirit } 
				if = {
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			}
			navy_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.navy_spirit
					
					add_to_array = { selected_spirits = v }
				}
				
				set_variable = { selected_spirit_type = token:navy_spirit }
				set_variable = { selected_spirit_type_frame = 13 }
				
				set_temp_variable = { tt = token:navy_spirit } 
				if = {
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			}
			naval_command_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.naval_command_spirit
					
					add_to_array = { selected_spirits = v }
				}
				
				set_variable = { selected_spirit_type = token:naval_command_spirit }
				set_variable = { selected_spirit_type_frame = 4 }
				
				set_temp_variable = { tt = token:naval_command_spirit } 
				if = {
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			}
			
			air_force_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.air_force_spirit
					
					add_to_array = { selected_spirits = v }
				}
				
				set_variable = { selected_spirit_type = token:air_force_spirit }
				set_variable = { selected_spirit_type_frame = 7 }
				
				set_temp_variable = { tt = token:air_force_spirit } 
				if = {
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			 }
			air_force_command_spirit_click = {
				clear_array = selected_spirits
				for_each_loop = {
					array = global.air_force_command_spirit
					
					add_to_array = { selected_spirits = v }
				}
				
				set_variable = { selected_spirit_type = token:air_force_command_spirit }
				set_variable = { selected_spirit_type_frame = 4 }
				
				set_temp_variable = { tt = token:air_force_command_spirit } 
				if = { 
					limit = {
						has_variable = spirit@var:tt
					}
					custom_effect_tooltip = "SPIRIT_TITLE_TT"
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}  
						X = "[?spirit@var:tt.GetTokenKey]"
					}
				}
			}
			
			
		
			high_command_army_limit_click = { 
				
				if = {        
					limit = {       
						has_country_flag = { flag = has_high_command_army value = 2 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LIMIT_REACHED" 
				}     
				else_if = {     
					limit = {   
				 		has_country_flag = { flag = has_high_command_army value = 1 }
					}     
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_2"
				}
						
			}
			high_command_air_limit_click = { 
				
				if = {  
					limit = {    
						has_country_flag = { flag = has_high_command_air value = 2 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LIMIT_REACHED"
				} 
				else_if = {   
					limit = {
				 		has_country_flag = { flag = has_high_command_air value = 1 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_2"
				}
					
			}
			high_command_navy_limit_click = { 
				
				if = {  
					limit = { 
						has_country_flag = { flag = has_high_command_navy value = 2 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LIMIT_REACHED"
				} 
				else_if = {  
					limit = {
				 		has_country_flag = { flag = has_high_command_navy value = 1 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_2"
				}
						
			}
			
			theorist_army_limit_click = { 
				
				if = {  
					limit = {   
						has_country_flag = { flag = has_theorist_army value = 2 }
					}   
					custom_effect_tooltip = "THEORIST_LIMIT_REACHED"
				}  
				else_if = {   
					limit = {
				 		has_country_flag = { flag = has_theorist_army value = 1 }
					}    
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_2"
				}
						
			}
			theorist_air_limit_click = { 
				
				if = {  
					limit = {    
						has_country_flag = { flag = has_theorist_air value = 2 }
					}   
					custom_effect_tooltip = "THEORIST_LIMIT_REACHED" 
				}     
				else_if = {   
					limit = { 
				 		has_country_flag = { flag = has_theorist_air value = 1 }
					}    
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_1"
				} 
				else = {
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_2"
				}
						
			}
			theorist_navy_limit_click = { 
				  
				if = {  
					limit = { 
						has_country_flag = { flag = has_theorist_navy value = 2 }
					}   
					custom_effect_tooltip = "THEORIST_LIMIT_REACHED"
				} 
				else_if = {  
					limit = {
				 		has_country_flag = { flag = has_theorist_navy value = 1 }
					}   
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_2"
				}
						
			}
		}
	}
	BI_officer_window_land_no_nsb = {
		context_type = player_context
		
		window_name = "BI_officer_tab_container_no_nsb"
		parent_window_name = officer_core_view_no_spirit
		 
		effects = {
			
			high_command_army_limit_click = { 
				
				if = {        
					limit = {       
						has_country_flag = { flag = has_high_command_army value = 2 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LIMIT_REACHED" 
				}     
				else_if = {     
					limit = {   
				 		has_country_flag = { flag = has_high_command_army value = 1 }
					}     
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_2"
				}
						
			}
			high_command_air_limit_click = { 
				
				if = {  
					limit = {    
						has_country_flag = { flag = has_high_command_air value = 2 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LIMIT_REACHED"
				} 
				else_if = {   
					limit = {
				 		has_country_flag = { flag = has_high_command_air value = 1 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_2"
				}
					
			}
			high_command_navy_limit_click = { 
				
				if = {  
					limit = { 
						has_country_flag = { flag = has_high_command_navy value = 2 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LIMIT_REACHED"
				} 
				else_if = {  
					limit = {
				 		has_country_flag = { flag = has_high_command_navy value = 1 }
					}   
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "HIGH_COMMAND_LEFT_SLOT_2"
				}
						
			}
			
			theorist_army_limit_click = { 
				
				if = {  
					limit = {   
						has_country_flag = { flag = has_theorist_army value = 2 }
					}   
					custom_effect_tooltip = "THEORIST_LIMIT_REACHED"
				}  
				else_if = {   
					limit = {
				 		has_country_flag = { flag = has_theorist_army value = 1 }
					}    
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_2"
				}
						
			}
			theorist_air_limit_click = { 
				
				if = {  
					limit = {    
						has_country_flag = { flag = has_theorist_air value = 2 }
					}   
					custom_effect_tooltip = "THEORIST_LIMIT_REACHED" 
				}     
				else_if = {   
					limit = { 
				 		has_country_flag = { flag = has_theorist_air value = 1 }
					}    
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_1"
				} 
				else = {
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_2"
				}
						
			}
			theorist_navy_limit_click = { 
				  
				if = {  
					limit = { 
						has_country_flag = { flag = has_theorist_navy value = 2 }
					}   
					custom_effect_tooltip = "THEORIST_LIMIT_REACHED"
				} 
				else_if = {  
					limit = {
				 		has_country_flag = { flag = has_theorist_navy value = 1 }
					}   
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_1"
				}
				else = {
					custom_effect_tooltip = "THEORIST_LEFT_SLOT_2"
				}
						
			}
		}
	}
	BI_selected_spirit = {
		context_type = player_context
		
		window_name = "BI_selected_spirit_container"
		parent_scripted_gui = BI_officer_window_land
		
		visible = {
			has_variable = selected_spirit_type
		}
		 
		properties = {
			icon = {
				image = GFX_idea_[?v.GetTokenKey]
			}
			select_spirit = { 
				frame = frame_tile
			}  
			icon_inherited_spirit_bg = {
				frame = selected_spirit_type_frame
			}
		} 
		
		dynamic_lists = {
			spirit_list = {  
				#array = global.countries
				array = selected_spirits
		  		change_scope = yes
				entry_container = "military_spirit_entry"
			}
		}    

		effects = {
			close_click = {
				clear_variable = selected_spirit_type
				clear_variable = selected_spirit_type_frame
				clear_array = selected_spirits
			}
			spirit_overlay1_click = {
				clear_variable = selected_spirit_type
				clear_variable = selected_spirit_type_frame
				clear_array = selected_spirits
			}
			spirit_overlay2_click = {
				clear_variable = selected_spirit_type
				clear_variable = selected_spirit_type_frame
				clear_array = selected_spirits
			}
			spirit_overlay3_click = {
				clear_variable = selected_spirit_type
				clear_variable = selected_spirit_type_frame
				clear_array = selected_spirits
			}
			spirit_overlay4_click = {
				clear_variable = selected_spirit_type
				clear_variable = selected_spirit_type_frame
				clear_array = selected_spirits
			}
			select_spirit_click = {
				effect_tooltip = {
					meta_effect = {
						text = {
							custom_effect_tooltip = idea_desc|[X]
							[X]_data = yes
						}
						X = "[?v.GetTokenKey]"
					}
				}
				if = {
					limit = {	
						NOT = { has_idea = var:v }
						meta_trigger = {
							text = {
								can_[X] = yes
							}
							X = "[?v.GetTokenKey]"
						}
						#has_army_experience > army_xp_cost
						#has_air_experience > air_xp_cost
						#has_navy_experience > navy_xp_cost
					}
					if = {
						limit = {
							check_variable = { selected_spirit_type = token:academy_spirit }
						}
						set_temp_variable = { factor = 1 }
						add_to_temp_variable = { factor = modifier@academy_spirit_cost_factor }
						multiply_temp_variable = { army_xp_cost = factor }
					}
					multiply_temp_variable = { army_xp_cost = -1 }
					multiply_temp_variable = { air_xp_cost = -1 }
					multiply_temp_variable = { navy_xp_cost = -1 }
	
					
					hidden_effect = {
						army_experience = army_xp_cost
						air_experience = air_xp_cost
						navy_experience = navy_xp_cost
						
						if = {
							limit = {
								has_variable = spirit@var:selected_spirit_type
							}
							swap_ideas = {
								remove_idea = var:spirit@var:selected_spirit_type
								add_idea = var:v
							}
						}
						else = {
							add_ideas = var:v
						}
					}
					set_variable = { spirit@var:selected_spirit_type = v }
				}
			}
		}
		
		triggers = {
			cost_visible = {
				NOT = {
					check_variable = { spirit@var:selected_spirit_type = v }
				}
			}
			icon_background_army_visible = {
				OR = {
					check_variable = { selected_spirit_type = token:academy_spirit }
					check_variable = { selected_spirit_type = token:army_spirit }
					check_variable = { selected_spirit_type = token:division_command_spirit }
				}
			}
			icon_background_air_visible = {
				OR = {
					check_variable = { selected_spirit_type = token:air_force_spirit }
					check_variable = { selected_spirit_type = token:air_force_command_spirit }
				}
			}
			icon_background_navy_visible = {
				OR = {
					check_variable = { selected_spirit_type = token:naval_academy_spirit }
					check_variable = { selected_spirit_type = token:navy_spirit }
					check_variable = { selected_spirit_type = token:naval_command_spirit }
				}
			}
			select_spirit_click_enabled = {
				set_temp_variable = { frame_tile = 1 }
				if = {
		 			limit = {
						check_variable = { spirit@var:selected_spirit_type = v }
				 	}
					set_temp_variable = { frame_tile = 2 }
			 	}
				else = {
					meta_trigger = {
						text = {
							can_[X] = yes
						}
						X = "[?v.GetTokenKey]"
					}
					if = {
						limit = { NOT = { check_variable = { army_xp_cost = 0 } } }
						if = {
							limit = {
								check_variable = { selected_spirit_type = token:academy_spirit }
							}
							set_temp_variable = { factor = 1 }
							add_to_temp_variable = { factor = modifier@academy_spirit_cost_factor }
							multiply_temp_variable = { army_xp_cost = factor }
						}
						has_army_experience > army_xp_cost
					}
					if = {
						limit = { NOT = { check_variable = { air_xp_cost = 0 } } }
						has_air_experience > air_xp_cost
					}
					if = {
						limit = { NOT = { check_variable = { navy_xp_cost = 0 } } }
						has_navy_experience > navy_xp_cost
					}
				}
			}
		}
		      
	}
	BI_min_cons_goods_view = {
		context_type = player_context
		  
		parent_window_name = "construction_lines_container"         
		window_name = "BI_min_cons_goods_container"  
		
		#dirty = BI_construction_update #pdx... you disappointed me again
		
		effects = { 
			cons_threshold_bg_click = {
				MTT_get_min_cons_goods_modifiers = yes 
			}
		}
	}
	BI_construction_view_menu = {
		context_type = player_context
		 
		window_name = "BI_construction_tab_container"
		parent_window_token = construction_tab

		 
		visible = {
		
		}

		effects = {
			show_buildings_click = {
				if = {
					limit = {
						has_country_flag = ui_show_building_list
					}
					clr_country_flag = ui_show_building_list
					clear_variable = ui_building_list
				}
				else = {
					set_country_flag = ui_show_building_list
					
					clear_array = buildings_list
					clear_array = buildings_list_parent
					clear_variable = ui_building_list
					for_each_loop = {
						array = global.buildings
						
						clear_variable = ui_num_building@var:v
					}
					
					every_controlled_state = {
						for_each_loop = {
							array = global.buildings
							
							if = {
								limit = {
									check_variable = { modifier@local_factories = 0 }
								}
								
								add_to_variable = { ROOT.ui_num_building@var:v = building_level@var:v }
							}
							else = {
										
								set_temp_variable = { local = modifier@local_factories }
								add_to_temp_variable = { local = 1 }
									
								set_temp_variable = { t = building_level@var:v }
								multiply_temp_variable = { t = local }
								add_to_variable = { ROOT.ui_num_building@var:v = t }
							}
						}
					}
					
					for_each_loop = {
						array = global.buildings
						
						if = {
							limit = {
								check_variable = { ui_num_building@var:v > 0 }
							}
							round_variable = ui_num_building@var:v
							add_to_array = { buildings_list = v }
							add_to_array = { buildings_list_parent = v }
						}
					}
				}
					
			}
			
			civilian_energy_icon_click = {
				if = {
					limit = {
						check_variable = { lack_of_energy@energy_civilian = 0 }
					}
					custom_effect_tooltip = CIVILIAN_ENERGY_SUFFICIENT
				}
				else = {
					custom_effect_tooltip = CIVILIAN_ENERGY_LACKING
					custom_effect_tooltip = alert_energy_lack_capacity_penalties
					custom_effect_tooltip = alert_energy_lack_civilian
				}
			}
			
			buildings_close_button_click = {
				clr_country_flag = ui_show_building_list
				clear_variable = ui_building_list
			}
			
		}
		
		triggers = {
			buildings_close_button_visible = {
				set_temp_variable = { used_ic = num_of_civilian_factories }
				subtract_from_temp_variable = { used_ic = num_of_available_civilian_factories }
				has_country_flag = ui_show_building_list
			}
			civilian_factory_overview_visible = {
				NOT = { check_variable = { used_ic = num_of_civilian_factories } }
			}
			civilian_factory_overview_good_visible = {
				check_variable = { used_ic = num_of_civilian_factories }
			}
		}
	}
	BI_building_list = {
		context_type = player_context
		 
		window_name = "BI_building_list_container"
		parent_window_token = construction_tab

		 
		visible = {
			has_country_flag = ui_show_building_list
		}

		dynamic_lists = {
			building_list = {  
				array = buildings_list
		  		change_scope = yes
				entry_container = "[GetBuildingEntryContainer]"
			}
		}    
		
		properties = {
			building_icon = {
				frame = global.building_frame@var:v
			}
		}

		effects = {
			building_click = {
				if = {
					limit = {
						set_temp_variable = { next_i = i }
						add_to_temp_variable = { next_i = 1 }
						check_variable = { ROOT.buildings_list_parent^next_i = v }
					}
					#log = "CLEAR"
					remove_from_array = { array = buildings_list index = next_i }
					remove_from_array = { array = buildings_list index = next_i }
					remove_from_array = { array = buildings_list_parent index = next_i }
					remove_from_array = { array = buildings_list_parent index = next_i }
					clear_variable = ui_building_list
				}
				else_if = {
					limit = {
						NOT = { check_variable = { ui_building_list = v } }
					}
					#log = "INITIATE"
					
					
					set_temp_variable = { next_i = i }
					add_to_temp_variable = { next_i = 1 }
					#add_to_array = { array = buildings_list value = 3 index = next_i }
					add_to_array = { array = buildings_list value = 2 index = next_i }
					add_to_array = { array = buildings_list value = 1 index = next_i }
					
					add_to_array = { array = buildings_list_parent value = v index = next_i }
					add_to_array = { array = buildings_list_parent value = v index = next_i }
					
					clear_variable = ui_num_building_owned@var:v
					clear_variable = ui_num_building_occupied@var:v
					
					set_variable = { ui_building_list = v }
					every_controlled_state = {
					
						if = {
							limit = {
								check_variable = { modifier@local_factories = 0 }
							}
							
							add_to_variable = { ROOT.ui_num_building_owned@var:v = building_level@var:v }
						}
						else = {
									
							set_temp_variable = { local = modifier@local_factories }
							add_to_temp_variable = { local = 1 }
								
							set_temp_variable = { t = building_level@var:v }
							multiply_temp_variable = { t = local }
							add_to_variable = { ROOT.ui_num_building_occupied@var:v = t }
						}
						
					}
						
				}
				
			}
		}
		
		triggers = {
			building_click_enabled = {
				set_temp_variable = { parent = buildings_list_parent^i }
			}
		}
	}
	
	BI_construction_speed_view_menu = {
		context_type = player_context
		
		window_name = "BI_construction_speed_view_menu_container"
		parent_window_name = possible_constructions
		
		triggers = { #DLC exclusive building, hide speed and icon if not active
			mega_gun_emplacement_speed_icon_visible = {
				has_dlc = Gotterdammerung
			}
			mega_gun_emplacement_speed_visible = {
				has_dlc = Gotterdammerung
			}
		}

		effects = {
			industrial_complex_click = {
				set_temp_variable = { building = token:industrial_complex }
				custom_effect_tooltip = industrial_complex_desc
				
				set_temp_variable = { need = constant:energy.cost.civilian }
				set_temp_variable = { factor = modifier@energy_need_civilian_factor }
				add_to_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				set_temp_variable = { conversion = constant:building.conversion.industrial_complex }
				
				#set_temp_variable = { days = global.building_cost@industrial_complex }
				#set_temp_variable = { speed = modifier@production_speed_buildings_factor }
				#add_to_temp_variable = { speed = modifier@production_speed_industrial_complex_factor }
				#add_to_temp_variable = { speed = 1 }
				#multiply_temp_variable = { speed = 3.2 }
				#multiply_temp_variable = { speed = 24 }
				#divide_temp_variable = { days = speed }
				
				custom_effect_tooltip = building_energy_tooltip
				if = {
					limit = {
						check_variable = { modifier@production_cost_industrial_complex_factor = 0 }
					}
					custom_effect_tooltip = building_cost_tooltip
				}
				else = {
					set_temp_variable = { actual_cost = global.building_cost@var:building }
					set_temp_variable = { factor = modifier@production_cost_industrial_complex_factor }
					add_to_temp_variable = { factor = 1 }
					multiply_temp_variable = { actual_cost = factor }
					custom_effect_tooltip = building_cost_modified_tooltip
				}
				custom_effect_tooltip = building_conversion_tooltip
			}
			arms_factory_click = {
				set_temp_variable = { building = token:arms_factory }
				custom_effect_tooltip = arms_factory_desc
				
				set_temp_variable = { need = constant:energy.cost.military }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				set_temp_variable = { conversion = constant:building.conversion.arms_factory }
				
				custom_effect_tooltip = building_energy_tooltip
				if = {
					limit = {
						check_variable = { modifier@production_cost_arms_factory_factor = 0 }
					}
					custom_effect_tooltip = building_cost_tooltip
				}
				else = {
					set_temp_variable = { actual_cost = global.building_cost@var:building }
					set_temp_variable = { factor = modifier@production_cost_arms_factory_factor }
					add_to_temp_variable = { factor = 1 }
					multiply_temp_variable = { actual_cost = factor }
					custom_effect_tooltip = building_cost_modified_tooltip
				}
				custom_effect_tooltip = building_conversion_tooltip
			}
			dockyard_click = {
				set_temp_variable = { building = token:dockyard }
				custom_effect_tooltip = dockyard_desc
				
				set_temp_variable = { need = constant:energy.cost.naval }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			shipyard_click = {
				set_temp_variable = { building = token:shipyard }
				if = {
					limit = {
						NOT = { has_tech = ship_industry }
					}
					set_temp_variable = { tech = token:ship_industry }
					custom_effect_tooltip = building_requirement_tooltip
				}
				custom_effect_tooltip = shipyard_desc
				
				set_temp_variable = { need = constant:energy.cost.assembly }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			subyard_click = {
				set_temp_variable = { building = token:subyard }
				if = {
					limit = {
						NOT = { has_tech = sub_industry }
					}
					set_temp_variable = { tech = token:sub_industry }
					custom_effect_tooltip = building_requirement_tooltip
				}
				custom_effect_tooltip = subyard_desc
				
				set_temp_variable = { need = constant:energy.cost.assembly }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			artillery_assembly_click = {
				set_temp_variable = { building = token:artillery_assembly }
				custom_effect_tooltip = artillery_assembly_desc
				
				set_temp_variable = { need = constant:energy.cost.assembly }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = artillery_assembly_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			engine_assembly_click = {
				set_temp_variable = { building = token:engine_assembly }
				custom_effect_tooltip = engine_assembly_desc
				
				set_temp_variable = { need = constant:energy.cost.assembly }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = engine_assembly_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			air_assembly_click = {
				set_temp_variable = { building = token:air_assembly }
				custom_effect_tooltip = air_assembly_desc
				
				set_temp_variable = { need = constant:energy.cost.assembly }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = air_assembly_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			tank_assembly_click = {
				set_temp_variable = { building = token:tank_assembly }
				custom_effect_tooltip = tank_assembly_desc
				
				set_temp_variable = { need = constant:energy.cost.assembly }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = tank_assembly_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			shipyard_capital_building_click = {
				set_temp_variable = { building = token:shipyard_capital_building }
				custom_effect_tooltip = shipyard_capital_building_desc
				
				set_temp_variable = { need = constant:energy.cost.assembly }
				set_temp_variable = { factor = modifier@energy_consumption_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { need = factor }
				
				custom_effect_tooltip = capital_assembly_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_unbuildable_tooltip
			}
			
			steel_refinery_click = {
				set_temp_variable = { building = token:steel_refinery }
				custom_effect_tooltip = steel_refinery_desc
				
				set_temp_variable = { need = constant:recipe.steel.energy }
				add_to_temp_variable = { need = modifier@steel_energy_cost }
							
				set_temp_variable = { output = constant:recipe.steel.output }
				add_to_temp_variable = { output = modifier@steel_conversion_output }
				
				custom_effect_tooltip = steel_refinery_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			aluminium_refinery_click = {
				set_temp_variable = { building = token:aluminium_refinery }
				custom_effect_tooltip = aluminium_refinery_desc
				
				set_temp_variable = { need = constant:recipe.aluminium.energy }
				add_to_temp_variable = { need = modifier@aluminium_energy_cost }
							
				set_temp_variable = { output = constant:recipe.aluminium.output }
				add_to_temp_variable = { output = modifier@aluminium_conversion_output }
				
				custom_effect_tooltip = aluminium_refinery_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			rubber_refinery_click = {
				set_temp_variable = { building = token:synthetic_rubber_refinery }
				if = {
					limit = {
						NOT = { has_tech = rubber_processing }
					}
					set_temp_variable = { tech = token:rubber_processing }
					custom_effect_tooltip = building_requirement_tooltip
				}
				custom_effect_tooltip = synthetic_rubber_refinery_desc
				
				set_temp_variable = { need = constant:recipe.rubber.energy }
				add_to_temp_variable = { need = modifier@rubber_energy_cost }
							
				set_temp_variable = { output = constant:recipe.rubber.output }
				add_to_temp_variable = { output = modifier@rubber_conversion_output }
				
				custom_effect_tooltip = rubber_refinery_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			fuel_refinery_click = {
				set_temp_variable = { building = token:synthetic_refinery }
				if = {
					limit = {
						NOT = { has_tech = synth_oil_experiments }
					}
					set_temp_variable = { tech = token:synth_oil_experiments }
					custom_effect_tooltip = building_requirement_tooltip
				}
				custom_effect_tooltip = synthetic_refinery_desc
				
				set_temp_variable = { need = constant:recipe.fuel.energy }
				add_to_temp_variable = { need = modifier@fuel_energy_cost }
							
				set_temp_variable = { output = constant:recipe.fuel.output }
				set_temp_variable = { factor = modifier@fuel_gain_factor_from_states }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { output = factor }
				
				custom_effect_tooltip = fuel_refinery_resource
				custom_effect_tooltip = building_energy_tooltip
				custom_effect_tooltip = building_cost_tooltip
			}
			power_plant_click = {
				set_temp_variable = { building = token:power_plant }
				custom_effect_tooltip = power_plant_desc
				
				set_temp_variable = { output = constant:energy.gain.plant }
				set_temp_variable = { factor = modifier@energy_production_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { output = factor }
				
				custom_effect_tooltip = power_plant_resource
				custom_effect_tooltip = building_cost_tooltip
			}
			hydro_power_click = {
				set_temp_variable = { building = token:hydro_power }
				custom_effect_tooltip = hydro_power_desc
				
				set_temp_variable = { output = constant:energy.gain.hydro }
				set_temp_variable = { factor = modifier@energy_hydro_factor }
				add_to_temp_variable = { factor = 1 }
				multiply_temp_variable = { output = factor }
				
				custom_effect_tooltip = hydro_power_resource
				custom_effect_tooltip = building_cost_tooltip
			}
		}
	}
	#Production-tab
	BI_production_view_menu = {
		context_type = player_context
		  
		window_name = "BI_production_view_container" 
		parent_window_token = production_tab
		
		visible = {  
			NOT = { has_country_flag = show_HTD }
		}    
	 	 
		properties = {
			shipyard = {
				frame = shipyard
			}
			subyard = {
				frame = subyard
			}
		}   
   
		effects = { 
			air_assembly_capacity_click = {    
				MTT_get_air_assembly_output = yes
			}
			tank_assembly_capacity_click = {    
				MTT_get_tank_assembly_output = yes
			}
			engine_assembly_capacity_click = {    
				MTT_get_engine_assembly_output = yes
			}
			artillery_assembly_capacity_click = {    
				MTT_get_artillery_assembly_output = yes
			}
			shipyard_assembly_capacity_click = {    
				MTT_get_capital_shipyard_output = yes
			}
			local_resources_icon_click = {
				MTT_get_resource_efficiency_modifiers = yes
			}
			production_start_efficiency_icon_click = {
				MTT_get_starting_efficiency_modifiers = yes
			}
			factory_output_factor_click = {
				MTT_get_industrial_capacity_factory_factor = yes
			}
			dockyard_output_factor_click = {
				MTT_get_industrial_capacity_dockyard_factor = yes
			}
			open_equipment_intro_click = {
				if = {
					limit = {
						has_country_flag = show_introduce_new_equipments_menu
					}
					clr_country_flag = show_introduce_new_equipments_menu
					clear_variable = selected_equipment
					clear_array = equipment_intro_list
					clear_array = equipment_unit_group_list
					clear_array = equipment_unit_group_deployed_list
				}
				else = {
					update_equipment_intro_UI = yes
					set_country_flag = show_introduce_new_equipments_menu
				}
			}
			alert_click = {
				d_update_equipment_intro_alert = yes
			}
		
			open_HSD_menu_click = {
				if = {
					limit = {
						has_country_flag = show_HTD
					}
					clr_country_flag = show_HTD
				}
				else = {
					set_country_flag = show_HTD
					clr_country_flag = HED_armor
					HTD_open_window = yes
					
					add_to_variable = { ui_HTD = 1 }
				}
			}
			open_HTD_menu_click = {
				if = {
					limit = {
						has_country_flag = show_HTD
					}
					clr_country_flag = show_HTD
				}
				else = {
					set_country_flag = show_HTD
					set_country_flag = HED_armor
					HTD_open_window = yes
					
					add_to_variable = { ui_HTD = 1 }
				}
			}
			military_energy_icon_click = { 
				if = {
					limit = {
						check_variable = { lack_of_energy@energy_military = 0 }
					}
					custom_effect_tooltip = MILITARY_ENERGY_SUFFICIENT
				}
				else = {
					custom_effect_tooltip = MILITARY_ENERGY_LACKING
					custom_effect_tooltip = alert_energy_lack_capacity_penalties
					custom_effect_tooltip = alert_energy_lack_military
				}
			}
			naval_energy_icon_click = { 
				if = {
					limit = {
						check_variable = { lack_of_energy@energy_naval = 0 }
					}
					custom_effect_tooltip = NAVAL_ENERGY_SUFFICIENT
				}
				else = {
					custom_effect_tooltip = NAVAL_ENERGY_LACKING
					custom_effect_tooltip = alert_energy_lack_capacity_penalties
					custom_effect_tooltip = alert_energy_lack_naval
				}
			}
			
		}
		
			
		
		triggers = {
			open_HSD_menu_visible = {
				major_country = yes 
			}
			open_HTD_menu_visible = {
				OR = {
					major_country = yes 
					tag = CAN
					tag = AST
					#tag = HUN
					tag = CZE
					#tag = SWE
					#tag = POL
				}
				
			}
			shipyard_click_enabled = {
				set_temp_variable = { shipyard = num_shipyard }
				add_to_temp_variable = { shipyard = 1 }
				
				set_temp_variable = { subyard = num_subyard }
				add_to_temp_variable = { subyard = 1 }
			}
			
			alert_visible = {
				check_variable = { num_alerts > 0 }
			}
			alerts_visible = {
				check_variable = { num_alerts > 0 }
			} 
			alert_click_enabled = {
				equipment_intro_alert = yes
			}
		}
	}
	BI_introduce_new_equipments_menu = {
		context_type = player_context
		 
		window_name = "BI_equipment_introduction_container"	
		parent_scripted_gui = BI_production_view_menu
		
		visible = {  
			has_country_flag = show_introduce_new_equipments_menu
		}
		
		#dirty = x
		properties = {  
			subunit_icon = {  
				image = "[GetEquipmentIntroGroupGFX]"
				frame = 2  
			}
			equipment_icon = {
				image = "[GetEquipmentIntroGFX]"
			}
			notification = {
				frame = frame
			}
		}
		effects = { 
			close_button_click = {
				clr_country_flag = show_introduce_new_equipments_menu
				clear_variable = selected_equipment
				clear_array = equipment_intro_list
				clear_array = equipment_unit_group_list
				clear_array = equipment_unit_group_deployed_list
			}
			notification_click = {
				meta_effect = {
					text = {
						if = {
							limit = {
								has_variable = notification_block_[X]@var:v
							}
							clear_variable = notification_block_[X]@var:v
						}
						else = {
							set_variable = { notification_block_[X]@var:v = 1 }
						}
					}
					X = "[?selected_equipment.GetTokenKey]"
				}
				add_to_variable = { ui_eq_intro_alert = 1 }
			}
			
			introduce_button_click = {
				if = {
					limit = {
						check_variable = { selected_equipment = var:v }
						check_variable = { equipment_unit_group_list^num > 0 }
					}
					clear_array = equipment_unit_group_list
				}
				else = {
					ROOT = { BI_add_unit_categories = yes }
				}
			}  
			 
			introduce_equipment_button_click = {
				if = {
					limit = {
						check_variable = { selected_equipment = token:mortar_equipment } #has that selected
						check_variable = { v = token:special_forces_group } #clicks on this group
						has_tech = mortars_2 #has this tech
					} #then add it to paratroopers as well
					hidden_effect = {
						set_technology = { mortar_equipment_paratrooper_group_tech = 1 popup = no }
					}
				}
				else_if = {
					limit = {
						check_variable = { selected_equipment = token:radio_equipment } #has that selected
						check_variable = { v = token:support_group } #clicks on this group
						has_tech = recon_radio #has this tech
					} #then add it to recon as well
					hidden_effect = {
						set_technology = { radio_equipment_recon_group_tech = 1 popup = no }
					}
				}
				hidden_effect = {
					set_variable = { introduce_unit_type = v }
					country_event = BI_on_action.447
				}
		 		remove_from_array = { Root.equipment_unit_group_list = var:v }
				#add_to_array = { Root.equipment_unit_group_deployed_list = var:v }
				
				introduce_equipments_big_ass_tooltip = yes
				#update_equipment_intro_UI = yes
				if = {
					limit = {
						check_variable = { Root.equipment_unit_group_list^num = 0 }
					}
					remove_from_array = { Root.equipment_intro_list = Root.selected_equipment }
					set_temp_variable = { v = Root.selected_equipment }
					BI_add_unit_categories = yes
					
					clear_variable = Root.selected_equipment
				}
				add_to_variable = { ui_eq_intro_alert = 1 }
			}
		} 
		
		triggers = { 
			notification_click_enabled = {
				meta_trigger = {
					text = {
						if = {
							limit = {
								has_variable = notification_block_[X]@var:v
							}
							set_temp_variable = { frame = 1 }
						}
						else = {
							set_temp_variable = { frame = 2 }
						}
					}
					X = "[?selected_equipment.GetTokenKey]"
				}
			}
			introduce_equipment_button_click_enabled = {
				if = {
					limit = {
						check_variable = { selected_equipment = token:radio_equipment }
					}
					
					if = { limit = { check_variable = { v = token:infantry_group } }
					
						has_tech = infantry_radio
					 	
					}
					else_if = { limit = { check_variable = { v = token:special_forces_group } }
					
						has_tech = infantry_radio
						
					}
					else_if = { limit = { check_variable = { v = token:mobile_group } }
					
						has_tech = vehicle_radio
					 	
					}
					#else_if = { limit = { check_variable = { v = token:support_group } }
					#
					#	has_tech = HQ_radio # deprecated tech
					#	
					#}
				}
			} 
			introduce_button_highlight_visible = {
				check_variable = { selected_equipment = v }
			}
		}
		
		dynamic_lists = {
			BI_equipment_introduction_list = {
				array = Root.equipment_intro_list 
				change_scope = yes
				entry_container = "BI_equipment_introduction_entry"
			}
			BI_unit_group_list = {
				array = Root.equipment_unit_group_list
				change_scope = yes
				entry_container = "BI_unit_group_entry"
			}
			BI_unit_group_deployed_list = {
				array = Root.equipment_unit_group_deployed_list
				change_scope = yes
				entry_container = "BI_unit_group_deployed_entry"
			}
		}
	}
	
	BI_continuous_focus_view = {
		context_type = player_context
		  
		window_name = "BI_continuous_focus_container"
		parent_window_name = "continuous_focus_window"
		
		triggers = {
			progress_10_on_visible = {
				check_variable = { focus_progress > 69.9 }
			}
			progress_20_on_visible = {
				check_variable = { focus_progress > 139.9 }
			}
			progress_30_on_visible = {
				check_variable = { focus_progress > 209.9 }
			}
			progress_40_on_visible = {
				check_variable = { focus_progress > 279.9 }
			}
			progress_50_on_visible = {
				check_variable = { focus_progress > 349.9 }
			}
			progress_60_on_visible = {
				check_variable = { focus_progress > 419.9 }
			}
			progress_70_on_visible = {
				check_variable = { focus_progress > 489.9 }
			}
			progress_80_on_visible = {
				check_variable = { focus_progress > 559.9 }
			}
			progress_90_on_visible = {
				check_variable = { focus_progress > 629.9 }
			}
			progress_100_on_visible = {
				check_variable = { focus_progress > 699.9 }
			}
		}
	}
	#BI_subjects_view_menu = {
	#	context_type = player_context
	#	  
	#	window_name = "BI_subjects_view_container"
	#	#parent_window_name = "subject_items_window"
	#	
	#	visible = {  
	#		always = no
	#		#check_variable = { subjects^num > 0 }
	#	}
	#
	#	dynamic_lists = {
	#		BI_subject_list = {
	#			array = Root.subjects
	#			change_scope = yes
	#			entry_container = "BI_subject_list_entry"
	#		}
	#	}
	#	  
	#	#dirty = EIC_update2
	#	
	#	effects = {
	#		subject_list_button_click = {
	#			set_variable = { Root.selected_subject = This.id }
	#		}
	#	}
	#}
	#BI_selected_subject_view_menu = {
	#	context_type = player_context
	#	  
	#	window_name = "BI_selected_subject_container"
	#	#parent_window_name = "manage_subjects_window"
	#	
	#	visible = { 
	#		always = no 
	#		#check_variable = { subjects^num > 0 }
	#	}
	#
	#	dynamic_lists = {
	#		BI_subject_list = {
	#			array = Root.subjects
	#			change_scope = yes
	#			entry_container = "BI_subject_list_entry"
	#		}
	#	} 
	#	  
	#	#dirty = EIC_update2
	#	
	#	effects = {
	#		subject_list_button_click = {
	#			set_variable = { Root.selected_subject = This.id }
	#		}
	#	}
	#} 
	BI_diplomacy_overlay = {
		context_type = selected_country_context

		window_name = "BI_diplomacy_overlay_container"
        parent_window_token = selected_country_view_diplomacy
		#parent_window_name = "diplomatic_actions_hook"
		   
		dynamic_lists = {
			diplomacy_list = {
				array = diplo
				change_scope = yes
				entry_container = "diplo_overlay_entry"
			}
			modifier_list = {
				array = diplo_modifiers
				change_scope = yes
				entry_container = "diplo_modifier_entry"
			}
			relation_list = {
				array = relation_modifiers
				change_scope = yes
				entry_container = "[GetRelationModifierBackground]"
				value = relation_v
				index = relation_i
			}
			setting_list = {
				array = ROOT.diplo_setting@THIS
				change_scope = yes
				entry_container = "[GetDiploViewContainer]"
			}
			favour_list = {
				array = global.diplomatic_favours
				change_scope = yes
				entry_container = "diplo_favour_entry"
				value = favour_v
			}
			their_favour_list = {
				array = global.diplomatic_favours
				change_scope = yes
				entry_container = "diplo_favour_their_entry"
				value = favour_v
			}
		}
		
		properties = {
			foreign_policy = {
				image = GFX_idea_[?foreign_policy.GetTokenKey]
			}
			volunteer_allowance = {
				frame = volunteer_frame
			}
			cancel_at_max_opinion = {
				frame = cancel_at_max_opinion
			}
			restart_to_max_opinion = {
				frame = restart_to_max_opinion
			}
			apply_setting_globally = {
				frame = apply_setting_globally
			}
			select_favour = {
				frame = select_favour
			}
			relation_icon = {
				image = "GFX_relation_[?relation_v.GetTokenKey]"
			}
			favour_flag = {
				image = "[?flag_tag.GetFlag]"
			}
			their_favour_flag = {
				image = "[?flag_tag.GetFlag]"
			}
			their_flag = {
				image = "[This.GetFlag]"
			}
			accept_icon = {
				frame = accept_frame
			}
		}
		
		triggers = {
			foreign_policy_click_enabled = {
				set_temp_variable = { foreign_policy = global.law@token:foreign_policy^law_level@token:foreign_policy }
				if = {
					limit = {
						NOT = { tag = ROOT }
					}
					generate_diplomacy_overlay = yes
					
					display_relation_modifiers = yes
					if = {
						limit = {
							check_variable = { relation_modifiers^num = 1 }
						}
						add_to_temp_array = { relation_modifiers = 0 }
					}
				}
				else = {
					if = {
						limit = {
							check_variable = { global.setting_status@diplomacy_justify_war = token:diplomacy_justify_war_free }
						}
						add_to_temp_array = { diplo_modifiers = token:generate_wargoal_tension  }
						add_to_temp_array = { diplo_modifiers = token:justify_war_goal_time  }
						add_to_temp_array = { diplo_modifiers = token:justify_war_goal_when_in_major_war_time  }
						add_to_temp_array = { diplo_modifiers = token:enemy_declare_war_tension  }
						add_to_temp_array = { diplo_modifiers = token:enemy_justify_war_goal_time  }
					}
					add_to_temp_array = { diplo_modifiers = token:trade_opinion_factor  }
					add_to_temp_array = { diplo_modifiers = token:faction_trade_opinion_factor  }
					add_to_temp_array = { diplo_modifiers = token:guarantee_tension  }
					add_to_temp_array = { diplo_modifiers = token:guarantee_cost  }
					add_to_temp_array = { diplo_modifiers = token:embargo_threshold_factor  }
					add_to_temp_array = { diplo_modifiers = token:embargo_cost_factor  }
					add_to_temp_array = { diplo_modifiers = token:join_faction_tension  }
					add_to_temp_array = { diplo_modifiers = token:lend_lease_tension  }
					#add_to_temp_array = { diplo_modifiers = token:lend_lease_tension_with_overlord  }
					add_to_temp_array = { diplo_modifiers = token:foreign_opinion_gain_monthly  }
					add_to_temp_array = { diplo_modifiers = token:foreign_opinion_gain_monthly_factor  }
					add_to_temp_array = { diplo_modifiers = token:opinion_gain_monthly  }
					add_to_temp_array = { diplo_modifiers = token:opinion_gain_monthly_factor  }
					add_to_temp_array = { diplo_modifiers = token:opinion_gain_monthly_same_ideology_factor  }
					add_to_temp_array = { diplo_modifiers = token:opinion_gain_monthly_different_ideology_factor  }
					add_to_temp_array = { diplo_modifiers = token:opinion_gain_monthly_ally_factor  }
					add_to_temp_array = { diplo_modifiers = token:max_opinion_gain  }
					#add_to_temp_array = { diplo_modifiers = token:request_lease_tension  }
					add_to_temp_array = { diplo_modifiers = token:send_volunteer_divisions_required  }
					add_to_temp_array = { diplo_modifiers = token:send_volunteer_factor  }
					add_to_temp_array = { diplo_modifiers = token:send_volunteer_size  }
					add_to_temp_array = { diplo_modifiers = token:send_volunteers_tension  }
					add_to_temp_array = { diplo_modifiers = token:air_volunteer_cap  }
					
					add_to_temp_array = { diplo_modifiers = token:drift_defence_factor  }
					#add_to_temp_array = { diplo_modifiers = token:foreign_subversive_activites  }
				}
				
			}
			
			diplo_bg_click_enabled = {
				diplomacy_overlay_entry_enabled = yes
			}
			diplo_bg_clickable_visible = {
				diplomacy_overlay_entry_trigger = yes
			}
			diplo_bg_clickable_click_enabled = {
				if = {
					limit = {
						check_variable = { v = token:improve_relations }
					}
					ROOT = { has_country_flag = improved_relation@PREV }
				}
			}
			diplo_bg_visible = {
				diplomacy_overlay_entry_visible = yes
			}
			diplo_name_visible = {
				diplomacy_overlay_entry_visible = yes
			}
			
			############# volunteers 
			
			volunteer_allowance_click_enabled = {
				ROOT = {
					if = {
						limit = {
							NOT = { 
								has_relation_modifier = {
									target = PREV
									modifier = diplomacy_disable_land_volunteers
								}
							}
							NOT = { 
								has_relation_modifier = {
									target = PREV
									modifier = diplomacy_disable_air_volunteers
								}
							}
						}
						set_temp_variable = { volunteer_frame = 1 }
					}
					else_if = {
						limit = {
							has_relation_modifier = {
								target = PREV
								modifier = diplomacy_disable_land_volunteers
							}
						}
						set_temp_variable = { volunteer_frame = 3 }
					}
					else_if = {
						limit = {
							has_relation_modifier = {
								target = PREV
								modifier = diplomacy_disable_air_volunteers
							}
						}
						set_temp_variable = { volunteer_frame = 2 }
					}
				}
			}
			
			cancel_at_max_opinion_click_enabled = {
				ROOT = {
					if = {
						limit = {
							has_country_flag = cancel_at_max_opinion@PREV
						}
						set_temp_variable = { cancel_at_max_opinion = 2 }
					}
					else = { set_temp_variable = { cancel_at_max_opinion = 1 } }
				}
			}
			restart_to_max_opinion_click_enabled = {
				ROOT = {
					if = {
						limit = {
							has_country_flag = restart_to_max_opinion@PREV
						}
						set_temp_variable = { restart_to_max_opinion = 2 }
					}
					else = { set_temp_variable = { restart_to_max_opinion = 1 } }
				}
			}
			apply_setting_globally_click_enabled = {
				ROOT = {
					if = {
						limit = {
							has_country_flag = apply_setting_globally
						}
						set_temp_variable = { apply_setting_globally = 2 }
					}
					else = { set_temp_variable = { apply_setting_globally = 1 } }
				}
			}
			
			volunteer_allowance_visible = {
				check_variable = { v = token:send_volunteers }
			}
			settings_visible = {
				check_variable = { v = token:improve_relations }
			}
			relation_icon_visible = {
				NOT = { check_variable = { relation_v = 0 } }
			}
			
			select_favour_click_enabled = {
			
				if = {
					limit = {
						OR = {
							check_variable = { ROOT.favour@var:favour_v = THIS }
							check_variable = { THIS.favour@var:favour_v = ROOT }
						}
					}
					set_temp_variable = { select_favour = 2 }
				}
				else = { 
					set_temp_variable = { select_favour = 1 }
					can_send_favour_request = yes
						
					if = {
						limit = {
							diplomacy_favour_ai_acceptance = yes
						}
						if = {
							limit = {
								check_variable = { positive > negative }
							}
							set_temp_variable = { accept_frame = 2 }
						}
						else = {
							set_temp_variable = { accept_frame = 1 }
						}
					}
					
				}
				
				NOT = {
					has_variable = ROOT.sent_favour_request@THIS
				}
				
				can_propose_favour = yes
			}
			abort_click_enabled = {
				if = {
					limit = {
						check_variable = { favour@var:favour_v = ROOT }
					}
					cancel_favour = yes
				}
			}
			favour_flag_visible = {
				NOT = {
					check_variable = { ROOT.favour@var:favour_v = THIS }
				}
				has_variable = ROOT.favour@var:favour_v
				set_temp_variable = { flag_tag = ROOT.favour@var:favour_v }
			}
			their_favour_flag_visible = {
				has_variable = favour@var:favour_v
				set_temp_variable = { flag_tag = favour@var:favour_v }
			}
			accept_icon_visible = {
				is_ai = yes
				NOT = {
					check_variable = { ROOT.favour@var:favour_v = THIS }
				}
			}
			player_icon_visible = {
				is_ai = no
			}
			favour_visible = {
				NOT = { tag = ROOT }
				
				NOT = { has_war_with = ROOT }
			}
		}
			
		effects = {	
			their_flag_click = {
				ROOT = {
					if = {
						limit = {
							has_country_flag = show_their_favour@PREV
						}
						clr_country_flag = show_their_favour@PREV
					}
					else = { set_country_flag = show_their_favour@PREV }
				}
			}
			diplo_modifier_entry_click = {
				custom_effect_tooltip = "[GetDiploModifierEntryDesc]"
			}
			foreign_policy_click = {
				meta_effect = {
					text = {
						show_ideas_tooltip = [X]
					}
					X = "[?foreign_policy.GetTokenKey]"
				}
			}
			diplo_bg_clickable_click = {
				improve_relation_tooltip = yes
			}
			accept_icon_click = {
				ai_favour_acceptance = yes
			}
			select_favour_click = {
				set_temp_variable = { sender = ROOT }
				set_temp_variable = { receiver = THIS }
				if = {
					limit = {
						OR = {
							check_variable = { ROOT.favour@var:favour_v = THIS }
							check_variable = { THIS.favour@var:favour_v = ROOT }
						}
					}
					custom_effect_tooltip = CANCEL_FAVOUR_EFFECT
					effect_tooltip = {
						set_temp_variable = { on_add = 1 }
						set_temp_variable = { on_remove = 0 }
						meta_effect = {
							text = {
								[X] = yes
							}
							X = "[?favour_v.GetTokenKey]"
						}
					}
					hidden_effect = {
						set_temp_variable = { on_add = 0 }
						set_temp_variable = { on_remove = 1 }
						meta_effect = {
							text = {
								[X] = yes
							}
							X = "[?favour_v.GetTokenKey]"
						}
					}
					var:sender = {
						var:receiver = {
							add_opinion_modifier = {
								target = PREV
								modifier = cancelled_favour
							}
						}
					}
					effect_tooltip = {
						set_temp_variable = { on_add = 0 }
						set_temp_variable = { on_remove = 0 }
						set_temp_variable = { on_active = 1 }
						meta_effect = {
							text = {
								[X] = yes
							}
							X = "[?favour_v.GetTokenKey]"
						}
						set_temp_variable = { on_active = 0 }
					}
					if = {
						limit = {
							var:sender = {
								check_variable = { favour@var:favour_v = receiver }
							}
						}
						var:sender = { 
							clear_variable = favour@var:favour_v 
							subtract_from_variable = { num_favour@var:receiver = 1 }
						}
					}
					if = {
						limit = {
							var:receiver = {
								check_variable = { favour@var:favour_v = sender }
							}
						}
						var:receiver = { 
							clear_variable = favour@var:favour_v 
							subtract_from_variable = { num_favour@var:sender = 1 }
						}
					}
					if = {
						limit = {
							var:receiver = {
								OR = {
									is_ai = no
									has_global_flag = favour_test_player
								}
							}
						}
						var:receiver = {
							add_to_array = { notification = token:notif_favour_cancelled }
							add_to_array = { notification_sender = sender }
							add_to_array = { notification_target = favour_v }
						}
					}
				}
				else_if = {
					limit = {
						has_variable = ROOT.favour@var:favour_v
					}
						
					custom_effect_tooltip = CANCEL_FAVOUR_AND_REQUEST_EFFECT
					
				### CANCEL EXISTING FAVOUR
					
					set_temp_variable = { receiver = ROOT.favour@var:favour_v }
					
					hidden_effect = {
						set_temp_variable = { on_add = 0 }
						set_temp_variable = { on_remove = 1 }
						meta_effect = {
							text = {
								[X] = yes
							}
							X = "[?favour_v.GetTokenKey]"
						}
					}
					var:sender = {
						var:receiver = {
							add_opinion_modifier = {
								target = PREV
								modifier = cancelled_favour
							}
						}
					}
					
					if = {
						limit = {
							var:sender = {
								check_variable = { favour@var:favour_v = receiver }
							}
						}
						var:sender = { 
							clear_variable = favour@var:favour_v 
							subtract_from_variable = { num_favour@var:receiver = 1 }
						}
					}
					if = {
						limit = {
							var:receiver = {
								check_variable = { favour@var:favour_v = sender }
							}
						}
						var:receiver = { 
							clear_variable = favour@var:favour_v 
							subtract_from_variable = { num_favour@var:sender = 1 }
						}
					}
					
					if = {
						limit = {
							var:receiver = {
								OR = {
									is_ai = no
									has_global_flag = favour_test_player
								}
							}
						}
						var:receiver = {
							add_to_array = { notification = token:notif_favour_cancelled }
							add_to_array = { notification_sender = sender }
							add_to_array = { notification_target = receiver }
						}
					}
					
				### REQUEST NEW FAVOUR
					custom_effect_tooltip = REQUEST_FAVOUR_EFFECT
					set_temp_variable = { receiver = THIS }
					
					request_favour = yes
					
					effect_tooltip = {
						set_temp_variable = { on_add = 1 }
						set_temp_variable = { on_remove = 0 }
						meta_effect = {
							text = {
								[X] = yes
							}
							X = "[?favour_v.GetTokenKey]"
						}
					}
				}
				else = {
					custom_effect_tooltip = REQUEST_FAVOUR_EFFECT
					
					request_favour = yes
					
					effect_tooltip = {
						set_temp_variable = { on_add = 1 }
						set_temp_variable = { on_remove = 0 }
						meta_effect = {
							text = {
								[X] = yes
							}
							X = "[?favour_v.GetTokenKey]"
						}
					}
				}
				if = {
					limit = {
						check_variable = { favour@var:favour_v = ROOT }
					}
					custom_effect_tooltip = CANCEL_FAVOUR_TRIGGER
				}
				if = {
					limit = {
						NOT = { check_variable = { favour@var:favour_v = ROOT } }
						can_send_favour_request = no
					}
					custom_effect_tooltip = PROPOSE_FAVOUR_OPINION
				}
				if = {
					limit = {
						has_war_with = ROOT
					}
					custom_effect_tooltip = PROPOSE_FAVOUR_WAR
				}
				
				if = {
					limit = {
						is_debug = yes
					}
					custom_effect_tooltip = "space_TT"
					custom_effect_tooltip = "debug key: [?favour_v.GetTokenKey]"
				}
			}
			select_their_favour_click = {
				if = {
					limit = {
						has_variable = THIS.favour@var:favour_v
					}
					custom_effect_tooltip = FAVOUR_THEIR_ACTIVE_TOOLTIP
				}
				else = { custom_effect_tooltip = FAVOUR_THEIR_INACTIVE_TOOLTIP }
			}
			relation_icon_click = {
				if = {
					limit = {
						NOT = { check_variable = { relation_v = 0 } }
					}
					effect_tooltip = {
						ROOT = {
							meta_effect = {
								text = {
									add_relation_modifier = {
										target = PREV
										modifier = [X]
									}
								}
								X = "[?relation_v.GetTokenKey]"
							}
						}
					}
				}
			}
			settings_click = {
				if = {
					limit = {
						is_in_array = { ROOT.diplo_setting@THIS = token:improve_relations }
					}
					clear_array = ROOT.diplo_setting@THIS
				}
				else = {
					clear_array = ROOT.diplo_setting@THIS
					add_to_array = { ROOT.diplo_setting@THIS = token:improve_relations }
				}
			}
			favour_click = {
				if = {
					limit = {
						is_in_array = { ROOT.diplo_setting@THIS = token:favours }
					}
					clear_array = ROOT.diplo_setting@THIS
				}
				else = {
					clear_array = ROOT.diplo_setting@THIS
					add_to_array = { ROOT.diplo_setting@THIS = token:favours }
				}
			}
			close_button_click = {
				clear_array = ROOT.diplo_setting@THIS
			}
			
			cancel_at_max_opinion_click = {
				ROOT = {
					if = {
						limit = {
							has_country_flag = cancel_at_max_opinion@PREV
						}
						clr_country_flag = cancel_at_max_opinion@PREV
					}
					else = { set_country_flag = cancel_at_max_opinion@PREV }
				}
			}
			restart_to_max_opinion_click = {
				ROOT = {
					if = {
						limit = {
							has_country_flag = restart_to_max_opinion@PREV
						}
						clr_country_flag = restart_to_max_opinion@PREV
								
						if = {
							limit = {
								is_in_array = { ROOT.resume_befriend = PREV }
							}
							remove_from_array = { ROOT.resume_befriend = PREV }
						}
					}
					else = { 
						set_country_flag = restart_to_max_opinion@PREV 
								
						if = {
							limit = {
								NOT = { is_in_array = { ROOT.resume_befriend = PREV } }
							}
							add_to_array = { ROOT.resume_befriend = PREV }
						}
					}
				}
			}
			apply_setting_globally_click = {
				ROOT = {
					if = {
						limit = {
							has_country_flag = apply_setting_globally
						}
						clr_country_flag = apply_setting_globally
					}
					else = { set_country_flag = apply_setting_globally }
				}
			}
			volunteer_allowance_click = {
				ROOT = {
					if = {
						limit = {
							NOT = { 
								has_relation_modifier = {
									target = PREV
									modifier = diplomacy_disable_land_volunteers
								}
							}
							NOT = { 
								has_relation_modifier = {
									target = PREV
									modifier = diplomacy_disable_air_volunteers
								}
							}
						}
						custom_effect_tooltip = diplomacy_allow_both_volunteers
					}
					else_if = {
						limit = {
							has_relation_modifier = {
								target = PREV
								modifier = diplomacy_disable_land_volunteers
							}
						}
						custom_effect_tooltip = diplomacy_allow_air_volunteers
					}
					else_if = {
						limit = {
							has_relation_modifier = {
								target = PREV
								modifier = diplomacy_disable_air_volunteers
							}
						}
						custom_effect_tooltip = diplomacy_allow_land_volunteers
					}
				}
			}
			diplo_bg_click = {
				#custom_effect_tooltip = "[From.GetTag] [Root.GetTag]"
				
				if = {
					limit = {
						check_variable = { v = token:justify_war_goal }
					}
					custom_effect_tooltip = DIPLOMACY_GENERATE_WARGOAL_ACTION_DESC
				}
				else_if = {
					limit = {
						check_variable = { v = token:send_volunteers }
					}
					custom_effect_tooltip = DIPLOMACY_SEND_VOLUNTEERS_ACTION_DESC
				}
				else_if = {
					limit = {
						check_variable = { v = token:improve_relations }
					}
					cancel_improve_relations = yes
				}
				else_if = {
					limit = {
						check_variable = { v = token:adjust_ai_defense }
					}
					custom_effect_tooltip = adjust_ai_defense_desc
					set_variable = { ROOT.targeted_country = FROM }
			
					clear_array = ROOT.defence_array_list
					add_to_array = { ROOT.defence_array_list = 1 }
					add_to_array = { ROOT.defence_array_list = token:europe }
					add_to_array = { ROOT.defence_array_list = token:africa }
					add_to_array = { ROOT.defence_array_list = token:middle_east }
					add_to_array = { ROOT.defence_array_list = token:asia }
					add_to_array = { ROOT.defence_array_list = token:north_america }
					add_to_array = { ROOT.defence_array_list = token:south_america }
					add_to_array = { ROOT.defence_array_list = 2 }
			
					var:ROOT.targeted_country = {
						if = {
							limit = {
								NOT = { has_country_flag = ai_use_area_defense }
							}
							for_each_loop = {
								array = allies
								
								add_to_array = { ROOT.defence_array_list = v }
							}
							for_each_loop = {
								array = subjects
								
								if = {
									limit = {
										NOT = { is_in_array = { ROOT.defence_array_list = v } }
									}
									add_to_array = { ROOT.defence_array_list = v }
								}
							}
						
							if = {
								limit = {
									is_subject = yes
								}
								OVERLORD = {
									if = {
										limit = {
											NOT = { is_in_array = { ROOT.defence_array_list = THIS } }
										}
										add_to_array = { ROOT.defence_array_list = THIS }
									}
								}
							}
						}
					}
					
					ROOT = { 
						clr_country_flag = ui_ai_country_defence_THIS
						set_country_flag = ui_ai_country_defence 
						clr_country_flag = ui_show_ai_production
					}
					
				}
				else_if = {
					limit = {
						check_variable = { v = token:adjust_ai_production }
					}
					custom_effect_tooltip = adjust_ai_production_desc
					
					set_variable = { ROOT.targeted_country = FROM }
					ROOT = {
						clr_country_flag = ui_ai_country_defence
						set_country_flag = ui_show_ai_production
						clr_country_flag = ui_show_ai_air_production
						clr_country_flag = ui_show_ai_navy_production
					}
					ui_show_ai_army_production = yes
				}
				
			}
		}
		
	}
	BI_capitulation_window = {
		context_type = player_context
		
		window_name = "BI_capitulation_container"	
		
		visible = {  
			check_variable = { capitulated^num > 0 }
		}
		
		dynamic_lists = {
			capitulated_list = {
				array = capitulated
				change_scope = yes
				entry_container = "capitulated_entry_container"
			}
			equipment_list = {
				array = captured_equiment
				change_scope = yes
				entry_container = "equipment_entry_container"
			}
		}
		
		properties = {
			icon = {
				image = [GetCapitulationEquipmentIcon]
			}
			sender_flag = {
				image = [This.GetFlag]
			}
			receiver_flag = {
				image = [Root.GetFlag]
			}
		}
		
		effects = {
			send_button_click = {
				for_each_loop = {
					array = global.archetypes
					
					clear_variable = capitulate_stock@var:v
				}
				clear_variable = capitulate_stock@garrison_equipment
					
				clear_variable = transfer_stockpile
				clear_variable = transfer_fuel
				clear_variable = capitulate_fuel
				
				if = {
					limit = {
						check_variable = { ROOT.capitulated^num > 1 }
					}
					ROOT = { remove_from_array = { capitulated = PREV } }
				}
				else = { clear_array = ROOT.capitulated }
			}
		}
		triggers = {
			send_button_click_enabled = {
				clear_temp_array = captured_equiment
				add_to_temp_array = { captured_equiment = token:fuel }
				all_of = {
					array = global.archetypes
						
					if = {
						limit = {
							check_variable = { capitulate_stock@var:v > 0 }
						}
						add_to_temp_array = { captured_equiment = v }
					}
				}
				if = {
					limit = {
						check_variable = { capitulate_stock@garrison_equipment > 0 }
					}
					add_to_temp_array = { captured_equiment = token:garrison_equipment }
				}
			}
			icon_click_enabled = {
				set_temp_variable = { amount = capitulate_stock@var:v }
				if = {
					limit = {
						check_variable = { v = token:fuel }
					}
					set_temp_variable = { amount = capitulate_fuel }
				}
			}
		}
		
	}
	
	BI_notification = {
		context_type = player_context
		 
		window_name = "BI_notification_container"	
		parent_window_token = topbar
		
		visible = {  
			check_variable = { notification^num > 0 }
		}
		 
		dynamic_lists = {
			notification_list = {
				array = notification
				change_scope = yes
				entry_container = "[GetNotificationContainer]"
			}
		}
		
		properties = {
			sender_flag = {
				image = "[?notification_sender^i.GetFlag]"
			}
			receiver_flag = {
				image = "[This.GetFlag]"
			}
		}
		
		effects = {
			close_button_click = {
				if = {
					limit = {
						check_variable = { v = token:notif_mobilization }
					}
					set_country_flag = { flag = mobilization_warning value = 1 days = 60 }
				}
				else_if = {
					limit = {
						check_variable = { v = token:notif_difficulty }
					}
				}
				else_if = {
					limit = {
						NOT = {
							check_variable = { v = token:notif_invasion }
						}
					}
					set_temp_variable = { sender = notification_sender^i }
					set_temp_variable = { receiver = notification_target^i }
					var:receiver = {
						var:sender = { clear_variable = sent_favour_request@PREV }
					}
				}
				
				remove_from_array = { notification = v }
				remove_from_array = { array = notification_sender index = i }
				remove_from_array = { array = notification_target index = i }
			}
			mobilize_button_click = {
				#add_ideas = mob_general 
				set_temp_variable = { cost = 30 }
				set_temp_variable = { modifier = modifier@mobilization_laws_cost_factor }
				add_to_temp_variable = { modifier = 1 }
				add_to_temp_variable = { modifier = law_cost_discount@token:mobilization_laws }
				clear_variable = law_cost_discount@token:mobilization_laws
				multiply_temp_variable = { cost = modifier }
				multiply_temp_variable = { cost = -1 }
				add_political_power = cost
				
				effect_tooltip = {
					if = {
						limit = {
							has_idea = mob_reserve
							can_take_mob_standing = yes
						}
						swap_ideas = {
							add_idea = mob_standing
							remove_idea = mob_reserve
						}
					}
					else_if = {
						limit = {
							has_idea = mob_standing
							can_take_mob_limited = yes
						}
						swap_ideas = {
							add_idea = mob_limited
							remove_idea = mob_standing
						}
					}
					else_if = {
						limit = {
							has_idea = mob_limited
							can_take_mob_general = yes
						}
						swap_ideas = {
							add_idea = mob_general
							remove_idea = mob_limited
						}
					}
				}
				hidden_effect = {
					if = {
						limit = {
							has_idea = mob_reserve
							can_take_mob_standing = yes
						}
						add_ideas = mob_standing
					}
					else_if = {
						limit = {
							has_idea = mob_standing
							can_take_mob_limited = yes
						}
						add_ideas = mob_limited
					}
					else_if = {
						limit = {
							has_idea = mob_limited
							can_take_mob_general = yes
						}
						add_ideas = mob_general
					}
				}
				set_country_flag = { flag = mobilization_warning value = 1 days = 60 }
				remove_from_array = { notification = v }
				remove_from_array = { array = notification_sender index = i }
				remove_from_array = { array = notification_target index = i }
			}
			
			ok_button_click = {
				if = {
					limit = {
						NOT = {
							check_variable = { v = token:notif_invasion }
						}
					}
					set_temp_variable = { sender = notification_sender^i }
					set_temp_variable = { receiver = notification_target^i }
					set_temp_variable = { favour_v = v }
					accept_favour = yes
						
					var:receiver = {
						var:sender = { clear_variable = sent_favour_request@PREV }
					}
				}
				
				remove_from_array = { notification = v }
				remove_from_array = { array = notification_sender index = i }
				remove_from_array = { array = notification_target index = i }
			
			}
			goto_state_button_click = {
				meta_effect = {
					text = {
						goto_state = [ID]
					}
					ID = "[?notification_target^i.GetID]"
				}
				remove_from_array = { notification = v }
				remove_from_array = { array = notification_sender index = i }
				remove_from_array = { array = notification_target index = i }
			}
			disable_button_click = {
				set_country_flag = notif_disable_inv_warning
				remove_from_array = { notification = v }
				remove_from_array = { array = notification_sender index = i }
				remove_from_array = { array = notification_target index = i }
			}
		}
		
	}
	
}
