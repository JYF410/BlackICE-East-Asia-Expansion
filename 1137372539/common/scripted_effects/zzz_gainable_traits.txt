
unit_leader_on_startup_effect = { #player only atm
	every_unit_leader = {
		
		if = {
			limit = {
				has_trait = desert_1
			}
			set_variable = { desert_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = desert_2
			}
			set_variable = { desert_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = desert_3
			}
			set_variable = { desert_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = desert_4
			}
			set_variable = { desert_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = desert_5
			}
			set_variable = { desert_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = desert_6
			}
			set_variable = { desert_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = desert_7
			}
			set_variable = { desert_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = desert_8
			}
			set_variable = { desert_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = desert_9
			}
			set_variable = { desert_lvl = 9 }
		}
		
		if = {
			limit = {
				has_trait = swamp_1
			}
			set_variable = { swamp_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = swamp_2
			}
			set_variable = { swamp_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = swamp_3
			}
			set_variable = { swamp_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = swamp_4
			}
			set_variable = { swamp_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = swamp_5
			}
			set_variable = { swamp_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = swamp_6
			}
			set_variable = { swamp_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = swamp_7
			}
			set_variable = { swamp_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = swamp_8
			}
			set_variable = { swamp_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = swamp_9
			}
			set_variable = { swamp_lvl = 9 }
		}
		
		if = {
			limit = {
				has_trait = hills_1
			}
			set_variable = { hills_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = hills_2
			}
			set_variable = { hills_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = hills_3
			}
			set_variable = { hills_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = hills_4
			}
			set_variable = { hills_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = hills_5
			}
			set_variable = { hills_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = hills_6
			}
			set_variable = { hills_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = hills_7
			}
			set_variable = { hills_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = hills_8
			}
			set_variable = { hills_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = hills_9
			}
			set_variable = { hills_lvl = 9 }
		}
		
		if = {
			limit = {
				has_trait = mountain_1
			}
			set_variable = { mountain_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = mountain_2
			}
			set_variable = { mountain_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = mountain_3
			}
			set_variable = { mountain_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = mountain_4
			}
			set_variable = { mountain_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = mountain_5
			}
			set_variable = { mountain_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = mountain_6
			}
			set_variable = { mountain_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = mountain_7
			}
			set_variable = { mountain_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = mountain_8
			}
			set_variable = { mountain_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = mountain_9
			}
			set_variable = { mountain_lvl = 9 }
		}
		
		if = {
			limit = {
				has_trait = urban_1
			}
			set_variable = { urban_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = urban_2
			}
			set_variable = { urban_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = urban_3
			}
			set_variable = { urban_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = urban_4
			}
			set_variable = { urban_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = urban_5
			}
			set_variable = { urban_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = urban_6
			}
			set_variable = { urban_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = urban_7
			}
			set_variable = { urban_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = urban_8
			}
			set_variable = { urban_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = urban_9
			}
			set_variable = { urban_lvl = 9 }
		}
		
		if = {
			limit = {
				has_trait = jungle_1
			}
			set_variable = { jungle_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = jungle_2
			}
			set_variable = { jungle_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = jungle_3
			}
			set_variable = { jungle_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = jungle_4
			}
			set_variable = { jungle_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = jungle_5
			}
			set_variable = { jungle_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = jungle_6
			}
			set_variable = { jungle_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = jungle_7
			}
			set_variable = { jungle_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = jungle_8
			}
			set_variable = { jungle_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = jungle_9
			}
			set_variable = { jungle_lvl = 9 }
		}
		
		if = {
			limit = {
				has_trait = forest_1
			}
			set_variable = { forest_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = forest_2
			}
			set_variable = { forest_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = forest_3
			}
			set_variable = { forest_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = forest_4
			}
			set_variable = { forest_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = forest_5
			}
			set_variable = { forest_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = forest_6
			}
			set_variable = { forest_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = forest_7
			}
			set_variable = { forest_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = forest_8
			}
			set_variable = { forest_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = forest_9
			}
			set_variable = { forest_lvl = 9 }
		}
		
		if = {
			limit = {
				has_trait = winter_1
			}
			set_variable = { winter_lvl = 1 }
		}
		else_if = {
			limit = {
				has_trait = winter_2
			}
			set_variable = { winter_lvl = 2 }
		}
		else_if = {
			limit = {
				has_trait = winter_3
			}
			set_variable = { winter_lvl = 3 }
		}
		else_if = {
			limit = {
				has_trait = winter_4
			}
			set_variable = { winter_lvl = 4 }
		}
		else_if = {
			limit = {
				has_trait = winter_5
			}
			set_variable = { winter_lvl = 5 }
		}
		else_if = {
			limit = {
				has_trait = winter_6
			}
			set_variable = { winter_lvl = 6 }
		}
		else_if = {
			limit = {
				has_trait = winter_7
			}
			set_variable = { winter_lvl = 7 }
		}
		else_if = {
			limit = {
				has_trait = winter_8
			}
			set_variable = { winter_lvl = 8 }
		}
		else_if = {
			limit = {
				has_trait = winter_9
			}
			set_variable = { winter_lvl = 9 }
		}
		
		set_temp_variable = { total = desert_lvl }
		add_to_temp_variable = { total = forest_lvl }
		add_to_temp_variable = { total = swamp_lvl }
		add_to_temp_variable = { total = urban_lvl }
		add_to_temp_variable = { total = mountain_lvl }
		add_to_temp_variable = { total = hills_lvl }
		add_to_temp_variable = { total = jungle_lvl }
		add_to_temp_variable = { total = winter_lvl } #should winter count to terrain_level? yes
		
		meta_effect = {
			text = {
				set_unit_leader_flag = { flag = terrain_level value = [X] }
			}
			X = "[?total]"
		}
	}
}
trait_desert_on_add = {
	set_temp_variable = { lvl = desert_lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		set_temp_variable = { xp = desert_xp }
		set_temp_variable = { need = global.desert_xp^lvl }
		custom_effect_tooltip = DESERT_XP_GAIN_TOOLTIP
		
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { attack = lvl }
		multiply_temp_variable = { attack = 1.5 }
		set_temp_variable = { defense = lvl }
		multiply_temp_variable = { defense = 1.5 }
		set_temp_variable = { movement = lvl }
		
		custom_effect_tooltip = "  Desert"
		custom_effect_tooltip = TRAIT_XP_EFFECT_TOOLTIP
	}
}
trait_swamp_on_add = {
	set_temp_variable = { lvl = swamp_lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		set_temp_variable = { xp = swamp_xp }
		set_temp_variable = { need = global.swamp_xp^lvl }
		custom_effect_tooltip = SWAMP_XP_GAIN_TOOLTIP
		
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { attack = lvl }
		multiply_temp_variable = { attack = 1.5 }
		set_temp_variable = { defense = lvl }
		multiply_temp_variable = { defense = 1.5 }
		set_temp_variable = { movement = lvl }
		
		custom_effect_tooltip = "  Marsh"
		custom_effect_tooltip = TRAIT_XP_EFFECT_TOOLTIP
	}
}
trait_hills_on_add = {
	set_temp_variable = { lvl = hills_lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		set_temp_variable = { xp = hills_xp }
		set_temp_variable = { need = global.hills_xp^lvl }
		custom_effect_tooltip = HILLS_XP_GAIN_TOOLTIP
		
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { attack = lvl }
		multiply_temp_variable = { attack = 1.5 }
		set_temp_variable = { defense = lvl }
		multiply_temp_variable = { defense = 1.5 }
		set_temp_variable = { movement = lvl }
		
		custom_effect_tooltip = "  Hills"
		custom_effect_tooltip = TRAIT_XP_EFFECT_TOOLTIP
	}
}
trait_mountain_on_add = {
	set_temp_variable = { lvl = mountain_lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		set_temp_variable = { xp = mountain_xp }
		set_temp_variable = { need = global.mountain_xp^lvl }
		custom_effect_tooltip = MOUNTAIN_XP_GAIN_TOOLTIP
		
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { attack = lvl }
		multiply_temp_variable = { attack = 1.5 }
		set_temp_variable = { defense = lvl }
		multiply_temp_variable = { defense = 1.5 }
		set_temp_variable = { movement = lvl }
		
		custom_effect_tooltip = "  Mountain"
		custom_effect_tooltip = TRAIT_XP_EFFECT_TOOLTIP
	}
}
trait_urban_on_add = {
	set_temp_variable = { lvl = urban_lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		set_temp_variable = { xp = urban_xp }
		set_temp_variable = { need = global.urban_xp^lvl }
		custom_effect_tooltip = URBAN_XP_GAIN_TOOLTIP
		
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { attack = lvl }
		multiply_temp_variable = { attack = 1.5 }
		set_temp_variable = { defense = lvl }
		multiply_temp_variable = { defense = 1.5 }
		set_temp_variable = { movement = lvl }
		
		custom_effect_tooltip = "  Town, Major City & Capital"
		custom_effect_tooltip = TRAIT_XP_EFFECT_TOOLTIP
	}
}
trait_forest_on_add = {
	set_temp_variable = { lvl = forest_lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		set_temp_variable = { xp = forest_xp }
		set_temp_variable = { need = global.forest_xp^lvl }
		custom_effect_tooltip = FOREST_XP_GAIN_TOOLTIP
		
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { attack = lvl }
		multiply_temp_variable = { attack = 1.5 }
		set_temp_variable = { defense = lvl }
		multiply_temp_variable = { defense = 1.5 }
		set_temp_variable = { movement = lvl }
		
		custom_effect_tooltip = "  Forest"
		custom_effect_tooltip = TRAIT_XP_EFFECT_TOOLTIP
	}
}
trait_jungle_on_add = {
	set_temp_variable = { lvl = jungle_lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		set_temp_variable = { xp = jungle_xp }
		set_temp_variable = { need = global.jungle_xp^lvl }
		custom_effect_tooltip = JUNGLE_XP_GAIN_TOOLTIP
			
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { attack = lvl }
		multiply_temp_variable = { attack = 1.5 }
		set_temp_variable = { defense = lvl }
		multiply_temp_variable = { defense = 1.5 }
		set_temp_variable = { movement = lvl }
		
		custom_effect_tooltip = "  Jungle"
		custom_effect_tooltip = TRAIT_XP_EFFECT_TOOLTIP
	}
}
trait_winter_on_add = {
	set_temp_variable = { lvl = winter_lvl }
	set_temp_variable = { xp = winter_xp }
	set_temp_variable = { need = global.winter_xp^lvl }
	
	if = {
		limit = {
			check_variable = { lvl < 10 }
		}
		custom_effect_tooltip = WINTER_XP_GAIN_TOOLTIP
			
		custom_effect_tooltip = TRAIT_XP_LEVEL_TOOLTIP
		
		set_temp_variable = { winter_attrition = lvl }
		multiply_temp_variable = { winter_attrition = 1.5 }
		set_temp_variable = { acclimatization = lvl }
		multiply_temp_variable = { acclimatization = 3 }
		
		custom_effect_tooltip = TRAIT_XP_WINTER_EFFECT_TOOLTIP
	}
}

set_gainable_traits_properties = {
	clear_array = global.desert_xp

	add_to_array = { global.desert_xp = 100 } #1
	add_to_array = { global.desert_xp = 200 } #2
	add_to_array = { global.desert_xp = 300 } #3
	add_to_array = { global.desert_xp = 400 } #4
	add_to_array = { global.desert_xp = 500 } #5
	add_to_array = { global.desert_xp = 600 } #6
	add_to_array = { global.desert_xp = 700 } #7
	add_to_array = { global.desert_xp = 800 } #8
	add_to_array = { global.desert_xp = 900 } #9
	add_to_array = { global.desert_xp = 1000 } #10
	
	clear_array = global.swamp_xp

	add_to_array = { global.swamp_xp = 100 } #1
	add_to_array = { global.swamp_xp = 200 } #2
	add_to_array = { global.swamp_xp = 300 } #3
	add_to_array = { global.swamp_xp = 400 } #4
	add_to_array = { global.swamp_xp = 500 } #5
	add_to_array = { global.swamp_xp = 600 } #6
	add_to_array = { global.swamp_xp = 700 } #7
	add_to_array = { global.swamp_xp = 800 } #8
	add_to_array = { global.swamp_xp = 900 } #9
	add_to_array = { global.swamp_xp = 1000 } #10
	
	clear_array = global.hills_xp

	add_to_array = { global.hills_xp = 200 } #1
	add_to_array = { global.hills_xp = 400 } #2
	add_to_array = { global.hills_xp = 600 } #3
	add_to_array = { global.hills_xp = 800 } #4
	add_to_array = { global.hills_xp = 1000 } #5
	add_to_array = { global.hills_xp = 1200 } #6
	add_to_array = { global.hills_xp = 1400 } #7
	add_to_array = { global.hills_xp = 1600 } #8
	add_to_array = { global.hills_xp = 1800 } #9
	add_to_array = { global.hills_xp = 2000 } #10
	
	clear_array = global.mountain_xp

	add_to_array = { global.mountain_xp = 100 } #1
	add_to_array = { global.mountain_xp = 200 } #2
	add_to_array = { global.mountain_xp = 300 } #3
	add_to_array = { global.mountain_xp = 400 } #4
	add_to_array = { global.mountain_xp = 500 } #5
	add_to_array = { global.mountain_xp = 600 } #6
	add_to_array = { global.mountain_xp = 700 } #7
	add_to_array = { global.mountain_xp = 800 } #8
	add_to_array = { global.mountain_xp = 900 } #9
	add_to_array = { global.mountain_xp = 1000 } #10
	
	clear_array = global.urban_xp

	add_to_array = { global.urban_xp = 200 } #1
	add_to_array = { global.urban_xp = 400 } #2
	add_to_array = { global.urban_xp = 600 } #3
	add_to_array = { global.urban_xp = 800 } #4
	add_to_array = { global.urban_xp = 1000 } #5
	add_to_array = { global.urban_xp = 1200 } #6
	add_to_array = { global.urban_xp = 1400 } #7
	add_to_array = { global.urban_xp = 1600 } #8
	add_to_array = { global.urban_xp = 1800 } #9
	add_to_array = { global.urban_xp = 2000 } #10
	
	clear_array = global.jungle_xp

	add_to_array = { global.jungle_xp = 200 } #1
	add_to_array = { global.jungle_xp = 400 } #2
	add_to_array = { global.jungle_xp = 600 } #3
	add_to_array = { global.jungle_xp = 800 } #4
	add_to_array = { global.jungle_xp = 1000 } #5
	add_to_array = { global.jungle_xp = 1200 } #6
	add_to_array = { global.jungle_xp = 1400 } #7
	add_to_array = { global.jungle_xp = 1600 } #8
	add_to_array = { global.jungle_xp = 1800 } #9
	add_to_array = { global.jungle_xp = 2000 } #10
	
	clear_array = global.forest_xp

	add_to_array = { global.forest_xp = 200 } #1
	add_to_array = { global.forest_xp = 400 } #2
	add_to_array = { global.forest_xp = 600 } #3
	add_to_array = { global.forest_xp = 800 } #4
	add_to_array = { global.forest_xp = 1000 } #5
	add_to_array = { global.forest_xp = 1200 } #6
	add_to_array = { global.forest_xp = 1400 } #7
	add_to_array = { global.forest_xp = 1600 } #8
	add_to_array = { global.forest_xp = 1800 } #9
	add_to_array = { global.forest_xp = 2000 } #10
	
	clear_array = global.winter_xp

	add_to_array = { global.winter_xp = 200 } #1
	add_to_array = { global.winter_xp = 400 } #2
	add_to_array = { global.winter_xp = 600 } #3
	add_to_array = { global.winter_xp = 800 } #4
	add_to_array = { global.winter_xp = 1000 } #5
	add_to_array = { global.winter_xp = 1200 } #6
	add_to_array = { global.winter_xp = 1400 } #7
	add_to_array = { global.winter_xp = 1600 } #8
	add_to_array = { global.winter_xp = 1800 } #9
	add_to_array = { global.winter_xp = 2000 } #10
	
	clear_array = global.xp_gain

	add_to_array = { global.xp_gain = 0 } #0
	add_to_array = { global.xp_gain = 1 } #1
	add_to_array = { global.xp_gain = 1.90 } #2
	add_to_array = { global.xp_gain = 2.71 } #3
	add_to_array = { global.xp_gain = 3.439 } #4
	add_to_array = { global.xp_gain = 4.095 } #5
	add_to_array = { global.xp_gain = 4.685 } #6
	add_to_array = { global.xp_gain = 5.216 } #7
	add_to_array = { global.xp_gain = 5.694 } #8
	add_to_array = { global.xp_gain = 6.124 } #9
	add_to_array = { global.xp_gain = 6.511 } #10
	add_to_array = { global.xp_gain = 6.859 } #11
	add_to_array = { global.xp_gain = 7.172 } #12
	add_to_array = { global.xp_gain = 7.454 } #13
	add_to_array = { global.xp_gain = 7.708 } #14
	add_to_array = { global.xp_gain = 7.936 } #15
	add_to_array = { global.xp_gain = 8 } #16
	
}

update_gainable_traits_hourly = {
	set_temp_variable = { factor = modifier@terrain_trait_xp_gain_factor }
	add_to_temp_variable = { factor = From.modifier@terrain_trait_xp_gain_factor }
	add_to_temp_variable = { factor = 1.5 } #can use this to easily affect xp gain
	if = { 
		limit = { 
			check_variable = { num_units_in_combat > 0 } 
			set_temp_variable = { vol_check = num_units_offensive_combats }
			add_to_temp_variable = { vol_check = num_units_defensive_combats }
			check_variable = { num_units_in_combat = vol_check }
		}
	
		#DESERT
		if = {
			limit = {
				set_temp_variable = { xp = num_units_offensive_combats_against@desert }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@desert }
				check_variable = { xp > 0 }
				check_variable = { desert_lvl < 10 }
			}
			set_temp_variable = { gain = global.xp_gain^xp }
			multiply_temp_variable = { gain = factor }
			add_to_variable = { desert_xp = gain }
		}
		#SWAMP
		if = {
			limit = {
				set_temp_variable = { xp = num_units_offensive_combats_against@marsh }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@marsh }
				check_variable = { xp > 0 }
				check_variable = { swamp_lvl < 10 }
			}
			set_temp_variable = { gain = global.xp_gain^xp }
			multiply_temp_variable = { gain = factor }
			add_to_variable = { swamp_xp = gain }
		}
		#HILLS
		if = {
			limit = {
				set_temp_variable = { xp = num_units_offensive_combats_against@hills }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@hills }
				check_variable = { xp > 0 }
				check_variable = { hills_lvl < 10 }
			}
			set_temp_variable = { gain = global.xp_gain^xp }
			multiply_temp_variable = { gain = factor }
			add_to_variable = { hills_xp = gain }
		}
		#MOUNTAIN
		if = {
			limit = {
				set_temp_variable = { xp = num_units_offensive_combats_against@mountain }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@mountain }
				check_variable = { xp > 0 }
				check_variable = { mountain_lvl < 10 }
			}
			set_temp_variable = { gain = global.xp_gain^xp }
			multiply_temp_variable = { gain = factor }
			add_to_variable = { mountain_xp = gain }
		}
		#URBAN
		if = {
			limit = {
				set_temp_variable = { xp = num_units_offensive_combats_against@urban }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@urban }
				add_to_temp_variable = { xp = num_units_offensive_combats_against@densecity }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@densecity }
				add_to_temp_variable = { xp = num_units_offensive_combats_against@capital }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@capital }
				check_variable = { xp > 0 }
				check_variable = { urban_lvl < 10 }
			}
			set_temp_variable = { gain = global.xp_gain^xp }
			multiply_temp_variable = { gain = factor }
			add_to_variable = { urban_xp = gain }
		}
		#FOREST
		if = {
			limit = {
				set_temp_variable = { xp = num_units_offensive_combats_against@forest }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@forest }
				check_variable = { xp > 0 }
				check_variable = { forest_lvl < 10 }
			}
			set_temp_variable = { gain = global.xp_gain^xp }
			multiply_temp_variable = { gain = factor }
			add_to_variable = { forest_xp = gain }
		}
		#JUNGLE
		if = {
			limit = {
				set_temp_variable = { xp = num_units_offensive_combats_against@jungle }
				add_to_temp_variable = { xp = num_units_defensive_combats_on@jungle }
				check_variable = { xp > 0 }
				check_variable = { jungle_lvl < 10 }
			}
			set_temp_variable = { gain = global.xp_gain^xp }
			multiply_temp_variable = { gain = factor }
			add_to_variable = { jungle_xp = gain }
		}
	
		#WINTER
		if = {
			limit = {
				set_temp_variable = { xp = num_units_in_combat }
				multiply_temp_variable = { xp = 0.5 }
				multiply_temp_variable = { xp = avg_units_acclimation@cold_climate }
				round_temp_variable = xp
				check_variable = { xp > 0 }
				check_variable = { winter_lvl < 10 }
			}
			add_to_variable = { winter_xp = global.xp_gain^xp }
		}
	}
	else = { #VOLUNTEERS
	
		#DESERT
		if = {
			limit = {
				set_temp_variable = { xp = sum_unit_terrain_modifier@desert }
				check_variable = { xp > 0 }
				check_variable = { desert_lvl < 10 }
			}
			set_temp_variable = { xp_gained = global.xp_gain^xp }
			divide_temp_variable = { xp_gained = num_units }
			multiply_temp_variable = { xp_gained = factor }
			add_to_variable = { desert_xp = xp_gained }
		}
		#SWAMP
		if = {
			limit = {
				set_temp_variable = { xp = sum_unit_terrain_modifier@marsh }
				check_variable = { xp > 0 }
				check_variable = { swamp_xp < 10 }
			}
			set_temp_variable = { xp_gained = global.xp_gain^xp }
			divide_temp_variable = { xp_gained = num_units }
			multiply_temp_variable = { xp_gained = factor }
			add_to_variable = { swamp_xp = xp_gained }
		}
		#HILLS
		if = {
			limit = {
				set_temp_variable = { xp = sum_unit_terrain_modifier@hills }
				check_variable = { xp > 0 }
				check_variable = { hills_lvl < 10 }
			}
			set_temp_variable = { xp_gained = global.xp_gain^xp }
			divide_temp_variable = { xp_gained = num_units }
			multiply_temp_variable = { xp_gained = factor }
			add_to_variable = { hills_xp = xp_gained }
		}
		#MOUNTAIN
		if = {
			limit = {
				set_temp_variable = { xp = sum_unit_terrain_modifier@mountain }
				check_variable = { xp > 0 }
				check_variable = { mountain_lvl < 10 }
			}
			set_temp_variable = { xp_gained = global.xp_gain^xp }
			divide_temp_variable = { xp_gained = num_units }
			multiply_temp_variable = { xp_gained = factor }
			add_to_variable = { mountain_xp = xp_gained }
		}
		#URBAN
		if = {
			limit = {
				set_temp_variable = { xp = sum_unit_terrain_modifier@urban }
				check_variable = { xp > 0 }
				check_variable = { urban_lvl < 10 }
			}
			set_temp_variable = { xp_gained = global.xp_gain^xp }
			divide_temp_variable = { xp_gained = num_units }
			multiply_temp_variable = { xp_gained = factor }
			add_to_variable = { urban_xp = xp_gained }
		}
		#FOREST
		if = {
			limit = {
				set_temp_variable = { xp = sum_unit_terrain_modifier@forest }
				check_variable = { xp > 0 }
				check_variable = { forest_lvl < 10 }
			}
			set_temp_variable = { xp_gained = global.xp_gain^xp }
			divide_temp_variable = { xp_gained = num_units }
			multiply_temp_variable = { xp_gained = factor }
			add_to_variable = { forest_xp = xp_gained }
		}
		#JUNGLE
		if = {
			limit = {
				set_temp_variable = { xp = sum_unit_terrain_modifier@jungle }
				check_variable = { xp > 0 }
				check_variable = { jungle_lvl < 10 }
			}
			set_temp_variable = { xp_gained = global.xp_gain^xp }
			divide_temp_variable = { xp_gained = num_units }
			multiply_temp_variable = { xp_gained = factor }
			add_to_variable = { jungle_xp = xp_gained }
		}
	}
}
update_gainable_traits = { #daily
	
	# UPDATE TRAIT EFFECTS
	if = { #DESERT
		limit = {
			check_variable = { desert_xp > global.desert_xp^desert_lvl }
			check_variable = { desert_lvl < 10 }
		}
		clear_variable = desert_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { desert_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = desert_[X]
				}
				X = "[?desert_lvl]"
			}
		}
		add_to_variable = { desert_lvl = 1 }
		if = {
			limit = {
				check_variable = { desert_lvl = 10 }
			}
			add_unit_leader_trait = desert_fox
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = desert_[X]
				}
				X = "[?desert_lvl]"
			}
		}
	}
	if = { #SWAMP
		limit = {
			check_variable = { swamp_xp > global.swamp_xp^swamp_lvl }
			check_variable = { swamp_lvl < 10 }
		}
		clear_variable = swamp_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { swamp_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = swamp_[X]
				}
				X = "[?swamp_lvl]"
			}
		}
		add_to_variable = { swamp_lvl = 1 }
		if = {
			limit = {
				check_variable = { swamp_lvl = 10 }
			}
			add_unit_leader_trait = swamp_fox
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = swamp_[X]
				}
				X = "[?swamp_lvl]"
			}
		}
	}
	if = { #HILLS
		limit = {
			check_variable = { hills_xp > global.hills_xp^hills_lvl }
			check_variable = { hills_lvl < 10 }
		}
		clear_variable = hills_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { hills_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = hills_[X]
				}
				X = "[?hills_lvl]"
			}
		}
		add_to_variable = { hills_lvl = 1 }
		if = {
			limit = {
				check_variable = { hills_lvl = 10 }
			}
			add_unit_leader_trait = hill_fighter
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = hills_[X]
				}
				X = "[?hills_lvl]"
			}
		}
	}
	if = { #MOUNTAIN
		limit = {
			check_variable = { mountain_xp > global.mountain_xp^mountain_lvl }
			check_variable = { mountain_lvl < 10 }
		}
		clear_variable = mountain_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { mountain_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = mountain_[X]
				}
				X = "[?mountain_lvl]"
			}
		}
		add_to_variable = { mountain_lvl = 1 }
		if = {
			limit = {
				check_variable = { mountain_lvl = 10 }
			}
			add_unit_leader_trait = trait_mountaineer
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = mountain_[X]
				}
				X = "[?mountain_lvl]"
			}
		}
	}
	if = { #URBAN
		limit = {
			check_variable = { urban_xp > global.urban_xp^urban_lvl }
			check_variable = { urban_lvl < 10 }
		}
		clear_variable = urban_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { urban_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = urban_[X]
				}
				X = "[?urban_lvl]"
			}
		}
		add_to_variable = { urban_lvl = 1 }
		if = {
			limit = {
				check_variable = { urban_lvl = 10 }
			}
			add_unit_leader_trait = urban_assault_specialist
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = urban_[X]
				}
				X = "[?urban_lvl]"
			}
		}
	}
	if = { #FOREST
		limit = {
			check_variable = { forest_xp > global.forest_xp^forest_lvl }
			check_variable = { forest_lvl < 10 }
		}
		clear_variable = forest_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { forest_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = forest_[X]
				}
				X = "[?forest_lvl]"
			}
		}
		add_to_variable = { forest_lvl = 1 }
		if = {
			limit = {
				check_variable = { forest_lvl = 10 }
			}
			add_unit_leader_trait = ranger
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = forest_[X]
				}
				X = "[?forest_lvl]"
			}
		}
	}
	if = { #JUNGLE
		limit = {
			check_variable = { jungle_xp > global.jungle_xp^jungle_lvl }
			check_variable = { jungle_lvl < 10 }
		}
		clear_variable = jungle_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { jungle_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = jungle_[X]
				}
				X = "[?jungle_lvl]"
			}
		}
		add_to_variable = { jungle_lvl = 1 }
		if = {
			limit = {
				check_variable = { jungle_lvl = 10 }
			}
			add_unit_leader_trait = jungle_rat
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = jungle_[X]
				}
				X = "[?jungle_lvl]"
			}
		}
	}
	if = { #WINTER
		limit = {
			check_variable = { winter_xp > global.winter_xp^winter_lvl }
			check_variable = { winter_lvl < 10 }
		}
		clear_variable = winter_xp
		
		if = {
			limit = {
				has_unit_leader_flag = terrain_level
			}
			modify_unit_leader_flag = { flag = terrain_level value = 1 }
		}
		else = {
			set_unit_leader_flag = terrain_level
		}
		
		if = {
			limit = {
				check_variable = { winter_lvl > 0 }
			}
			meta_effect = {
				text = {
					remove_unit_leader_trait = winter_[X]
				}
				X = "[?winter_lvl]"
			}
		}
		add_to_variable = { winter_lvl = 1 }
		if = {
			limit = {
				check_variable = { winter_lvl = 10 }
			}
			add_unit_leader_trait = winter_specialist
		}
		else = {
			meta_effect = {
				text = {
					add_unit_leader_trait = winter_[X]
				}
				X = "[?winter_lvl]"
			}
		}
	}
	
	if = {
		limit = {
			OR = {
				check_variable = { num_units_in_combat > 0 }
				has_unit_leader_flag = recent_combat
			}
		}
		
		update_gainable_traits_hourly = yes
		unit_leader_event = { id = generic.22 hours = 8 }
		unit_leader_event = { id = generic.23 hours = 16 }
		
	}
		
}