##### Operation Barbarossa #####
add_namespace = barbarossa
add_namespace = puppets

#Return of Romanian Lands if captured by axis forces
country_event = {
	id = barbarossa.1
	title = barbarossa.1.t
	desc = barbarossa.1.d
	picture = GFX_report_event_romanian_soldiers_gfxaddon
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		#tag = GER #EOA
		is_in_faction_with = ROM
		has_war_with = SOV
		ROM = { has_war_with = SOV }
		939 = {
			is_fully_controlled_by_ROOT_or_ally = yes
		}
		80 = {
			is_fully_controlled_by_ROOT_or_ally = yes
		}
		78 = {
			is_fully_controlled_by_ROOT_or_ally = yes
		}
	}
	option = {
		name = barbarossa.1.a
		ai_chance = { factor = 100 }
		
		ROM = { 
			transfer_state = 80 
			transfer_state = 78 
			transfer_state = 939 
		}
		
		80 = { remove_claim_by = GER }
		78 = { remove_claim_by = GER }
		939 = { remove_claim_by = GER }
	}
	option = {
		name = barbarossa.1.b
		
		add_political_power = -40
		
		ROM = { 
			add_opinion_modifier = {
				target = GER
				modifier = embargo
			} 
		}
	}
}
country_event = {
	id = barbarossa.2
	title = barbarossa.2.t
	desc = barbarossa.2.d
	picture = GFX_report_event_romanian_soldiers_gfxaddon
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		#tag = GER #EOA
		is_in_faction_with = ROM
		has_war_with = SOV
		ROM = { has_war_with = SOV }
		192 = {
			is_fully_controlled_by_ROOT_or_ally = yes
		}
		198 = {
			is_fully_controlled_by_ROOT_or_ally = yes
		}
	}
	option = {
		name = barbarossa.2.a
		ai_chance = { factor = 100 }
		
		ROM = { 
			transfer_state	= 192 
			transfer_state = 198 
		}
		192 = { remove_claim_by = GER }
		198 = { remove_claim_by = GER }
	}
	option = {
		name = barbarossa.2.b
	}
}

country_event = {
	id = barbarossa.3
	title = barbarossa.3.t
	desc = {
		text = barbarossa.3.dr
		trigger = {
			tag = ROM
		}
	}
	desc = {
		text = barbarossa.3.df
		trigger = {
			tag = FIN
		}
	}
	desc = {
		text = barbarossa.3.dh
		trigger = {
			tag = HUN
		}
	}
	desc = {
		text = barbarossa.3.db
		trigger = {
			tag = BUL
		}
	}
	picture = GFX_report_event_generic_sign_treaty1
	is_triggered_only = yes

	option = { #Ask for Peace
		name = barbarossa.3.a
		ai_chance = { factor = 100 }
		if = {
			limit = {
				tag = ROM
			}
			SOV = { 
				custom_effect_tooltip = needs_approval 
				country_event = { id = puppets.1 days = 1 } 
			}
		}
		if = {
			limit = {
				tag = FIN
			}
			SOV = { 
				custom_effect_tooltip = needs_approval 
				country_event = { id = puppets.6 days = 1 } 
			}
		}
		if = {
			limit = {
				tag = BUL
			}
			SOV = { 
				custom_effect_tooltip = needs_approval 
				country_event = { id = puppets.4 days = 1 } 
			}
		}
		if = {
			limit = {
				tag = HUN
			}
			SOV = { 
				custom_effect_tooltip = needs_approval 
				country_event = { id = puppets.3 days = 1 } 
			}
		}
		effect_tooltip = {
			white_peace = SOV
			white_peace = ENG
			
			SOV = {
				set_autonomy = {
					target = ROOT
					autonomous_state = autonomy_integrated_puppet
				}	
			}
			
			ROOT = {
				add_to_war = {
					targeted_alliance = SOV
					enemy = GER
				}
			}
		}
	}
	option = { #Stay in Axis
		name = barbarossa.3.b
		ai_chance = { factor = 0 }
		add_ideas = {
			GRE_communist_agitation
			GRE_army_collapse
		}
	}
}




#Romania
country_event = {
	id = puppets.1
	title = puppets.1.t
	desc = puppets.1.desc
	picture = GFX_report_event_romanian_officers
	
	fire_only_once = yes
	
	is_triggered_only = yes
	
	immediate = { set_global_flag = romanian_ssr }
	
	option = {
		name = puppets.1.a
		ai_chance = { factor = 100 }
		
		white_peace = ROM
		
		set_autonomy = {
			target = ROM
			autonomous_state = autonomy_integrated_puppet
		}
		
		ROM = {
			load_focus_tree = generic_focus
			effect_tooltip = {
				transfer_state = 938
				transfer_state = 79
				transfer_state = 937
				transfer_state = 76
				transfer_state = 83
				transfer_state = 82
				transfer_state = 81
				transfer_state = 84
				transfer_state = 46
				transfer_state = 855
				transfer_state = 931
				transfer_state = 77
			}
			
			add_to_temp_array = { switch_states = 938 }
			add_to_temp_array = { switch_states = 79 }
			add_to_temp_array = { switch_states = 937 }
			add_to_temp_array = { switch_states = 76 }
			add_to_temp_array = { switch_states = 83 }
			add_to_temp_array = { switch_states = 82 }
			add_to_temp_array = { switch_states = 81 }
			add_to_temp_array = { switch_states = 84 }
			add_to_temp_array = { switch_states = 46 }
			add_to_temp_array = { switch_states = 855 }
			add_to_temp_array = { switch_states = 931 }
			add_to_temp_array = { switch_states = 77 }
			
			for_each_scope_loop = { #transfer fully controlled states
				array = switch_states
				
				if = {
					limit = {
						is_fully_controlled_by = SOV
					}
					transfer_state_to = ROM
				}
				else = { #only transfer province controller of all occupied territory
					set_state_owner_to = ROM
					set_state_province_controller = {
						controller = ROM
						limit = {
							OR = {
								tag = SOV
								is_in_faction_with = SOV
								AND = {
									is_in_faction_with = ENG
									NOT = { has_war_with = SOV }
								}
							}
						}
					}
				}
			}
		}
		SOV = {
			set_state_owner = 80 
			set_state_owner = 78
			set_state_owner = 939
			set_state_owner = 198
			set_state_owner = 192
		}
		
		ROM = {
			add_to_war = {
				targeted_alliance = SOV
				enemy = GER
			}
		}
	}
	option = {
		name = puppets.1.b
		ai_chance = { factor = 0 }
		add_ideas = {
			GRE_army_collapse
			GRE_communist_agitation
		}
	}
}
#Hungary
country_event = {
	id = puppets.2
	title = puppets.2.t
	desc = puppets.2.desc
	picture = GFX_report_event_hungarian_toldi_tank
	
	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
		name = puppets.1.a
		ai_chance = { factor = 100 }
		white_peace = HUN
		
		set_autonomy = {
			target = HUN
			autonomous_state = autonomy_integrated_puppet
		}
			
		SOV = {
			set_state_owner = 73
		}		
		HUN = {
			load_focus_tree = generic_focus
			effect_tooltip = {
				transfer_state = 155
				transfer_state = 940
				transfer_state = 856
				transfer_state = 43
				transfer_state = 154
			}
			
			add_to_temp_array = { switch_states = 155 }
			add_to_temp_array = { switch_states = 940 }
			add_to_temp_array = { switch_states = 856 }
			add_to_temp_array = { switch_states = 43 }
			add_to_temp_array = { switch_states = 154 }
			
			for_each_scope_loop = { #transfer fully controlled states
				array = switch_states
				
				if = {
					limit = {
						is_fully_controlled_by = SOV
					}
					transfer_state_to = HUN
				}
				else = { #only transfer province controller of all occupied territory
					set_state_owner_to = HUN
					set_state_province_controller = {
						controller = HUN
						limit = {
							OR = {
								tag = SOV
								is_in_faction_with = SOV
								AND = {
									is_in_faction_with = ENG
									NOT = { has_war_with = SOV }
								}
							}
						}
					}
				}
			}
			add_to_war = {
				targeted_alliance = SOV
				enemy = GER
			}
		}
	}
	option = {
		name = puppets.1.b
		ai_chance = { factor = 0 }
	}
}
#Poland
country_event = {
	id = puppets.3
	title = puppets.3.t
	desc = puppets.3.desc
	picture = GFX_report_event_polish_resistance2
	
	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
		name = puppets.1.a
		ai_chance = { factor = 100 }
		
		set_autonomy = {
			target = POL
			autonomous_state = autonomy_integrated_puppet
		}
		
		SOV = {
			set_state_owner = 5
			set_state_owner = 188
			set_state_owner = 840
			set_state_owner = 96
			set_state_owner = 95
			set_state_owner = 94
			set_state_owner = 93
			set_state_owner = 91
			set_state_owner = 89
		}
		
		POL = {
			load_focus_tree = generic_focus
			effect_tooltip = {
				transfer_state = 63
				transfer_state = 97
				transfer_state = 98
				transfer_state = 839
				transfer_state = 85
				transfer_state = 86
				transfer_state = 87
				transfer_state = 10
				transfer_state = 862
				transfer_state = 92
				transfer_state = 90
				transfer_state = 88
				transfer_state = 67
				transfer_state = 66
				transfer_state = 893
				transfer_state = 894
				transfer_state = 762
				transfer_state = 471
				transfer_state = 842
			}
			
			add_to_temp_array = { switch_states = 63 }
			add_to_temp_array = { switch_states = 97 }
			add_to_temp_array = { switch_states = 98 }
			add_to_temp_array = { switch_states = 839 }
			add_to_temp_array = { switch_states = 85 }
			add_to_temp_array = { switch_states = 86 }
			add_to_temp_array = { switch_states = 87 }
			add_to_temp_array = { switch_states = 10 }
			add_to_temp_array = { switch_states = 862 }
			add_to_temp_array = { switch_states = 92 }
			add_to_temp_array = { switch_states = 90 }
			add_to_temp_array = { switch_states = 88 }
			add_to_temp_array = { switch_states = 67 }
			add_to_temp_array = { switch_states = 66 }
			add_to_temp_array = { switch_states = 893 }
			add_to_temp_array = { switch_states = 894 }
			add_to_temp_array = { switch_states = 762 }
			add_to_temp_array = { switch_states = 471 }
			add_to_temp_array = { switch_states = 842 }
			
			for_each_scope_loop = { #transfer fully controlled states
				array = switch_states
				
				if = {
					limit = {
						is_fully_controlled_by = SOV
					}
					transfer_state_to = POL
				}
				else = { #only transfer province controller of all occupied territory
					set_state_owner_to = POL
					set_state_province_controller = {
						controller = POL
						limit = {
							OR = {
								tag = SOV
								is_in_faction_with = SOV
								AND = {
									is_in_faction_with = ENG
									NOT = { has_war_with = SOV }
								}
							}
						}
					}
				}
			}
		}
		
		POL = {
			add_to_war = {
				targeted_alliance = SOV
				enemy = GER
			}
			hidden_effect = {
				set_technology = { partisans = 1 } 
				division_template = {
					name = "Polish Militia"
					template_counter = 512

					regiments = {
						militia = { x = 0 y = 0 }
						militia = { x = 0 y = 1 }
						militia = { x = 0 y = 2 }

						militia = { x = 1 y = 0 }
						militia = { x = 1 y = 1 }
						militia = { x = 1 y = 2 }

						partisan = { x = 2 y = 0 }
						partisan = { x = 2 y = 1 }
						partisan = { x = 2 y = 2 }
											
					}
					support = {
						DIV_HQ = { x = 0 y = 0 }
					}
				}
				capital_scope = {
					create_unit = {
						division = "division_template = \"Polish Militia\" start_experience_factor = 0.3 start_manpower_factor = 0.5 start_equipment_factor = 0.8"
						owner = POL
						count = 5
					}
				}
			}
		}
	}
	option = {
		name = puppets.1.b
		ai_chance = { factor = 0 }
	}
}	
#Bulgaria
country_event = {
	id = puppets.4
	title = puppets.4.t
	desc = puppets.4.desc
	picture = GFX_report_event_bulgarian_flag
	
	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
		name = puppets.1.a
		ai_chance = { factor = 100 }
		white_peace = BUL
		
		set_autonomy = {
			target = BUL
			autonomous_state = autonomy_integrated_puppet
		}
			
		BUL = {	
			load_focus_tree = generic_focus
			effect_tooltip = {
				transfer_state = 854
				transfer_state = 48
				transfer_state = 212
				transfer_state = 211
			}
			
			add_to_temp_array = { switch_states = 854 }
			add_to_temp_array = { switch_states = 48 }
			add_to_temp_array = { switch_states = 212 }
			add_to_temp_array = { switch_states = 211 }
			
			for_each_scope_loop = { #transfer fully controlled states
				array = switch_states
				
				if = {
					limit = {
						is_fully_controlled_by = SOV
					}
					transfer_state_to = BUL
				}
				else = { #only transfer province controller of all occupied territory
					set_state_owner_to = BUL
					set_state_province_controller = {
						controller = BUL
						limit = {
							OR = {
								tag = SOV
								is_in_faction_with = SOV
								AND = {
									is_in_faction_with = ENG
									NOT = { has_war_with = SOV }
								}
							}
						}
					}
				}
			}
			add_to_war = {
				targeted_alliance = SOV
				enemy = GER
			}
		}
		
		if = {
			limit = {
				731 = { is_owned_by = BUL }
			}
			185 = {
				OWNER = {
					set_state_owner = 731
				}
			}
		}
		if = {
			limit = {
				184 = { is_owned_by = BUL }
			}
			185 = {
				OWNER = {
					set_state_owner = 184
				}
			}
		}
	}
	option = {
		name = puppets.1.b
		ai_chance = { factor = 0 }
	}
}
#Czechoslovakia
country_event = {
	id = puppets.5
	title = puppets.5.t
	desc = puppets.5.desc
	picture = GFX_report_event_czech_soldiers_01
	
	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
		name = puppets.1.a
		ai_chance = { factor = 100 }
		white_peace = CZE
		
		set_autonomy = {
			target = CZE
			autonomous_state = autonomy_integrated_puppet
		}
			
		CZE = {
			load_focus_tree = generic_focus
			effect_tooltip = {
				transfer_state = 664
				transfer_state = 71
				transfer_state = 70
				transfer_state = 941
				transfer_state = 72
				transfer_state = 75
				transfer_state = 843
				transfer_state = 74
				transfer_state = 9
				transfer_state = 69
				transfer_state = 831
			}
			drop_cosmetic_tag = yes
			
			add_to_temp_array = { switch_states = 664 }
			add_to_temp_array = { switch_states = 71 }
			add_to_temp_array = { switch_states = 70 }
			add_to_temp_array = { switch_states = 941 }
			add_to_temp_array = { switch_states = 72 }
			add_to_temp_array = { switch_states = 75 }
			add_to_temp_array = { switch_states = 843 }
			add_to_temp_array = { switch_states = 74 }
			add_to_temp_array = { switch_states = 9 }
			add_to_temp_array = { switch_states = 69 }
			add_to_temp_array = { switch_states = 831 }
			
			for_each_scope_loop = { #transfer fully controlled states
				array = switch_states
				
				if = {
					limit = {
						is_fully_controlled_by = SOV
					}
					transfer_state_to = CZE
				}
				else = { #only transfer province controller of all occupied territory
					set_state_owner_to = CZE
					set_state_province_controller = {
						controller = CZE
						limit = {
							OR = {
								tag = SOV
								is_in_faction_with = SOV
								AND = {
									is_in_faction_with = ENG
									NOT = { has_war_with = SOV }
								}
							}
						}
					}
				}
			}
			
			add_to_war = {
				targeted_alliance = SOV
				enemy = GER
			}
			hidden_effect = {
				set_technology = { partisans = 1 } 
				division_template = {
					name = "Czecho Militia"
					template_counter = 512

					regiments = {
						militia = { x = 0 y = 0 }
						militia = { x = 0 y = 1 }
						militia = { x = 0 y = 2 }

						militia = { x = 1 y = 0 }
						militia = { x = 1 y = 1 }
						militia = { x = 1 y = 2 }

						partisan = { x = 2 y = 0 }
						partisan = { x = 2 y = 1 }
						partisan = { x = 2 y = 2 }
											
					}
					support = {
						DIV_HQ = { x = 0 y = 0 }
					}
				}
				capital_scope = {
					create_unit = {
						division = "division_template = \"Czecho Militia\" start_experience_factor = 0.3 start_manpower_factor = 0.5 start_equipment_factor = 0.8"
						owner = CZE
						count = 5
					}
				}
			}
		}
	}
	option = {
		name = puppets.1.b
		ai_chance = { factor = 0 }
	}
}
#Finland
country_event = {
	id = puppets.6
	title = puppets.6.t
	desc = puppets.6.desc
	picture = GFX_report_event_czech_soldiers_01
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		tag = SOV
		#has_global_flag = allied_invasion_persia
		has_war_with = GER
		has_war_with = FIN
	}
	
	
	option = {
		name = puppets.1.a
		ai_chance = { factor = 100 }
		white_peace = FIN
		
		set_autonomy = {
			target = FIN
			autonomous_state = autonomy_integrated_puppet
		}
			
		FIN = {
			load_focus_tree = generic_focus
			transfer_state = 111
			transfer_state = 150
			transfer_state = 149
			transfer_state = 148
			transfer_state = 878
			drop_cosmetic_tag = yes
			add_to_war = {
				targeted_alliance = SOV
				enemy = GER
			}
		}
	}
	option = {
		name = puppets.1.b
		ai_chance = { factor = 0 }
	}
}
### EOF ###